<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Studying the temperature readings | A blog by RicCap</title>
<meta name=keywords content="raspberry,IoT"><meta name=description content="Notes on plots and dataframes Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using nbconvert. As it turns out, the default output format used by nbconvert to display dataframes isn&rsquo;t rendered correctly by the Hugo backend I&rsquo;m using for the blog. I was not able to find a &ldquo;clean&rdquo; solution for it, so for this post (and until I&rsquo;ll find the actual fix) all tables are represented in raw html, rather than in a more decent format."><meta name=author content="Riccardo Cappuzzo"><link rel=canonical href=/posts/raspberry/study-temperature><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://rcap107.github.io/logo.png><link rel=icon type=image/png sizes=16x16 href=https://rcap107.github.io/logo.png><link rel=icon type=image/png sizes=32x32 href=https://rcap107.github.io/logo.png><link rel=apple-touch-icon href=https://rcap107.github.io/logo.png><link rel=mask-icon href=https://rcap107.github.io/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://rcap107.github.io/posts/raspberry/study-temperature/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Studying the temperature readings"><meta property="og:description" content="Notes on plots and dataframes Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using nbconvert. As it turns out, the default output format used by nbconvert to display dataframes isn&rsquo;t rendered correctly by the Hugo backend I&rsquo;m using for the blog. I was not able to find a &ldquo;clean&rdquo; solution for it, so for this post (and until I&rsquo;ll find the actual fix) all tables are represented in raw html, rather than in a more decent format."><meta property="og:type" content="article"><meta property="og:url" content="https://rcap107.github.io/posts/raspberry/study-temperature/"><meta property="og:image" content="https://rcap107.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-17T00:06:04+02:00"><meta property="article:modified_time" content="2022-07-17T00:06:04+02:00"><meta property="og:site_name" content="A blog by RicCap"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rcap107.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="Studying the temperature readings"><meta name=twitter:description content="Notes on plots and dataframes Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using nbconvert. As it turns out, the default output format used by nbconvert to display dataframes isn&rsquo;t rendered correctly by the Hugo backend I&rsquo;m using for the blog. I was not able to find a &ldquo;clean&rdquo; solution for it, so for this post (and until I&rsquo;ll find the actual fix) all tables are represented in raw html, rather than in a more decent format."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Main Subjects","item":"https://rcap107.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Playing with IoT devices","item":"https://rcap107.github.io/posts/raspberry/"},{"@type":"ListItem","position":3,"name":"Studying the temperature readings","item":"https://rcap107.github.io/posts/raspberry/study-temperature/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Studying the temperature readings","name":"Studying the temperature readings","description":"Notes on plots and dataframes Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using nbconvert. As it turns out, the default output format used by nbconvert to display dataframes isn\u0026rsquo;t rendered correctly by the Hugo backend I\u0026rsquo;m using for the blog. I was not able to find a \u0026ldquo;clean\u0026rdquo; solution for it, so for this post (and until I\u0026rsquo;ll find the actual fix) all tables are represented in raw html, rather than in a more decent format.","keywords":["raspberry","IoT"],"articleBody":"Notes on plots and dataframes Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using nbconvert. As it turns out, the default output format used by nbconvert to display dataframes isn’t rendered correctly by the Hugo backend I’m using for the blog. I was not able to find a “clean” solution for it, so for this post (and until I’ll find the actual fix) all tables are represented in raw html, rather than in a more decent format. I also need to figure out a better way of saving the plots, which allow to specify a facecolor, so that figures have a white background both in light and dark mode. For the time being, it’s possible to switch to light mode to fix that particular problem.\nThe nbconvert-generated version of this post is also available here.\nPlotting temperature and humidity sensor readings with matplotlib In this notebook, I will take a look at the readings from a DHT22 temperature-humidity sensor that I have left for a few days in a couple of locations in my house. As I’m writing this, we’re in the middle of the summer and there’s a heatwave going on, so the average temperatures will be pretty high.\nBy gathering data over the course of different days and by varying some conditions (e.g. opening certain windows), I’m hoping to find what’s the best way of cooling down the house at night, and keeping it cool during the day.\nLibraries Let’s start by talking about the libraries. Nothing pretty fancy here. pandas is there to put all the log readings into a dataframe, matplotlib and seaborn are graph visualization libraries for plotting data and datetime is there because I am working with timeseries. matplotlib.dates is used to customize some of the plotting parameters when handling dates.\nimport pandas as pd import matplotlib.pyplot as plt import seaborn as sns import datetime import matplotlib.dates as mdates Part 1: the attic Reading and cleaning the data The temperature/humidity readings are stored in a csv file, together with the timestamp of the reading. Let’s start with the readings coming from the sensor left in the attic.\ndf = pd.read_csv('log.txt', header=0, names=['date','time', 'temperature', 'humidity']) The next few commands are there for turning the datetime into a more manageable format, which helps with plotting later. In particular, since the date and time columns are read as strings, the following lines convert them back into datetime format.\nThen, the two are combined back into a singular datetime object for each row, with the entire timestamp.\ndf['time'] = df['time'].apply(datetime.time.fromisoformat) df['date'] = df['date'].apply(datetime.date.fromisoformat) df['datetime'] = pd.to_datetime([datetime.datetime.combine(a, b) for a,b in zip(df['date'], df['time'])]) Now that I have a unique datetime index for every row, I can reset the index of the dataframe so that it uses the timestamp, rather than the regular ID.\nThe next step is resampling the timeline in order to reduce the number of readings, and to reduce the effect of anomalous readings. In this example, readings are grouped every 30 minutes, then they are aggregated by using the mean function.\nOut of curiosity, and following a procedure I am not completely sure of, I am trying to plot the variance of the measurement over the same interval of time by aggregating with var, then plotting using the fill_between function.\n# Resetting the index so that it uses the datetime, then aggregating according to mean and variance. df_resampled = df.set_index('datetime').resample('30Min').mean() df_var = df.set_index('datetime').resample('30Min').var() Time for the first plots. Here, I am plotting all the readings from the moment I activated the process, to the moment I saved it on disk to study the readings. To better distinguish between days, I am searching for the timestamps with time (0,0) (i.e. midnight), then I’m saving them in the variable midnight.\nThe command df_resampled.index.time==datetime.time(0,0) looks in the .time attribute of the datetime objects in the index and checks if the value contained therein is the same as datetime.time(0,0).\nThe first plot will show the timeseries of temperature and humidity, along with their (supposed) error bars. Since I’m using the same code for plotting both temperature and humidity, I wrote a simple function that takes as input the dataframe and the variable of interest, then prepares the resulting plot.\ndef plot_overall_var(df, tgt_var, df_var=None): def get_bounds(df_base, df_var, column): '''Preparing the upper and lower bounds by adding the variance ''' y1 = df_base[column] + df_var[column] y2 = df_base[column] - df_var[column] return y1,y2 # Setting the size of the figure fig = plt.figure(figsize=(16,4)) # Plotting the main line ax = sns.lineplot(x=df_resampled.index, y=df_resampled[tgt_var]) plt.title(tgt_var) # If provided, adding the variance if df_var is not None: yhigh, ylow = get_bounds(df_resampled, df_var, tgt_var) plt.fill_between(df_resampled.index, ylow, yhigh, color='orange') # Plotting vertical lines for highlighting the change of date midnight = df_resampled.loc[df_resampled.index.time==datetime.time(0,0)].index for day in midnight: plt.axvline(day) # Plotting ticks every 3 hours _ = ax.xaxis.set_major_locator(mdates.HourLocator(interval=3)) # Rotating the ticks ax.xaxis.set_tick_params(rotation=60) # Tightening the result plt.tight_layout() plot_overall_var(df_resampled, 'temperature', df_var) plot_overall_var(df_resampled, 'humidity', df_var) Plotting results by day In the next section, I will reshape the data with the objective of comparing the readings gathered in different days, to look for potential similarities and differences. To do so, I’ll first split the datetime index into columns date and time, then I will pivot the table so that the new index will be time, and the columns will report temperature and humidity for each day. As you’ll notice, a bunch of values are missing and get with the value NaN: this is due to the fact that I started the data collection around 14h on July 13th.\ndf_resampled['date'] = df_resampled.index.date df_resampled['time'] = df_resampled.index.time df_pivot=df_resampled.pivot(index='time', columns='date') # Displaying only the first 10 rows df_pivot.head(10) temperature humidity date 2022-07-13 2022-07-14 2022-07-15 2022-07-16 2022-07-13 2022-07-14 2022-07-15 2022-07-16 time 00:00:00 NaN 29.640351 31.483636 31.187500 NaN 44.256141 41.012727 38.969643 00:30:00 NaN 29.321428 31.041071 30.917544 NaN 44.341071 40.332143 38.903509 01:00:00 NaN 29.025000 30.600000 30.540741 NaN 44.517857 40.024561 39.196297 01:30:00 NaN 28.775000 30.238182 30.076786 NaN 44.776786 39.936363 39.655357 02:00:00 NaN 28.519298 29.961403 29.866071 NaN 44.966667 40.045614 39.594642 02:30:00 NaN 28.323214 29.657143 29.710527 NaN 44.798214 39.983929 40.035088 03:00:00 NaN 28.083929 29.340000 29.500000 NaN 44.835714 39.558182 40.560714 03:30:00 NaN 27.839286 29.054386 29.285714 NaN 45.023214 39.131579 42.167857 04:00:00 NaN 27.514286 28.794643 29.000000 NaN 45.291072 39.330357 44.741072 04:30:00 NaN 27.251786 28.581818 28.656364 NaN 45.671428 40.038182 45.830909 Here I’m plotting the values of temperature and humidity recorded on each day.\ntime_range = pd.timedelta_range(start='1 day', end='2 days', freq='3H') fig, axs = plt.subplots(2,1, sharex=True, figsize=(10, 8)) df_pivot=df_resampled.pivot(index='time', columns='date') a=df_pivot['temperature'].plot(title='Temperature', ylabel='Temperature (*C)', ax=axs[0], legend=True) df_pivot=df_resampled.pivot(index='time', columns='date') df_pivot['humidity'].plot(ax=axs[1], title='Humidity', ylabel='Humidity (%)', legend=True) # plt.legend([a.lines]) plt.tight_layout() plt.savefig('temp-humid-attic.png', transparent=False, facecolor='white') Finding the daily extremes In this section, I will be parsing the data and look for the daily extremes (maximum and minimum) for temperature and humidity, and the time at which they occurred.\n# Simple dictionary for formatting the unit of measurement that will be printed d_form = {'temperature': '*C', 'humidity': '%'} # Grouping by day for idx, day_g in df_resampled.groupby('date'): print(f'Date: {idx}') # Maximum # idxmax returns the position of the maximum value aggr_i = day_g[['temperature', 'humidity']].aggregate(pd.Series.idxmax) aggr_m = day_g[['temperature', 'humidity']].aggregate(pd.Series.max) # Putting the values together for pretty printing df_t=pd.concat([aggr_i, aggr_m], axis=1) for i, val in df_t.iterrows(): print(f'Max {i:\u003e12} = {val[1]:.1f} {d_form[i]:\u003e2} at {val[0].time()}') # Minimum # idxmax returns the position of the maximum value aggr_i = day_g[['temperature', 'humidity']].aggregate(pd.Series.idxmin) aggr_m = day_g[['temperature', 'humidity']].aggregate(pd.Series.min) # Putting the values together for pretty printing df_t=pd.concat([aggr_i, aggr_m], axis=1) for i, val in df_t.iterrows(): print(f'Min {i:\u003e12} = {val[1]:.1f} {d_form[i]:\u003e2} at {val[0].time()}') Date: 2022-07-13 Max temperature = 33.5 *C at 18:00:00 Max humidity = 49.8 % at 14:30:00 Min temperature = 30.0 *C at 23:30:00 Min humidity = 42.6 % at 18:30:00 Date: 2022-07-14 Max temperature = 35.6 *C at 18:00:00 Max humidity = 47.4 % at 10:30:00 Min temperature = 26.4 *C at 07:30:00 Min humidity = 38.8 % at 19:00:00 Date: 2022-07-15 Max temperature = 36.3 *C at 16:00:00 Max humidity = 43.7 % at 10:00:00 Min temperature = 27.6 *C at 07:00:00 Min humidity = 33.4 % at 16:00:00 Date: 2022-07-16 Max temperature = 36.0 *C at 18:00:00 Max humidity = 51.1 % at 09:00:00 Min temperature = 27.7 *C at 07:30:00 Min humidity = 38.9 % at 00:30:00 Part 2: the bedroom In this section, I will be repeating most of what was done in Part 1: the main difference will be the location of the sensor. Rather than keeping it in the attic, in fact, I was keeping this on the desk in my bedroom. In particular, the sensor was exposed to the heat coming from a pretty chonky desktop PC, as well as two monitors, and it is positioned close to a window.\ndf = pd.read_csv('readings-room.csv', header=0, names=['date','time', 'temperature', 'humidity']) df['time'] = df['time'].apply(datetime.time.fromisoformat) df['date'] = df['date'].apply(datetime.date.fromisoformat) df['datetime'] = pd.to_datetime([datetime.datetime.combine(a, b) for a,b in zip(df['date'], df['time'])]) # Resetting the index so that it uses the datetime, then aggregating according to mean and variance. df_resampled = df.set_index('datetime').resample('30Min').mean() df_var = df.set_index('datetime').resample('30Min').var() Below, I’m plotting the overall temperature and humidity readings. Unlike in the case of the attic, however, the variance is far more larger, which leads to a plot that is almost unreadable in the case of humidity. For this reason, I am also plotting the graphs without added bands by calling plot_overall_var without the df_var variable.\nplot_overall_var(df_resampled, 'temperature', df_var) plot_overall_var(df_resampled, 'humidity', df_var) plot_overall_var(df_resampled, 'temperature') plot_overall_var(df_resampled, 'humidity') Plotting results by day df_resampled['date'] = df_resampled.index.date df_resampled['time'] = df_resampled.index.time df_pivot=df_resampled.pivot(index='time', columns='date') # Displaying only the first 10 rows df_pivot.head(10) temperature humidity date 2022-07-06 2022-07-07 2022-07-08 2022-07-06 2022-07-07 2022-07-08 time 00:00:00 NaN NaN 24.601786 NaN NaN 60.225000 00:30:00 NaN 26.792857 23.985965 NaN 62.985715 61.821053 01:00:00 NaN 26.937255 23.458929 NaN 62.368627 63.941071 01:30:00 NaN 26.825000 22.831579 NaN 62.901786 66.178947 02:00:00 NaN 26.421053 21.867273 NaN 63.638596 69.143637 02:30:00 NaN 26.396428 22.728572 NaN 64.705357 65.946429 03:00:00 NaN 26.171930 22.787719 NaN 64.521053 64.991228 03:30:00 NaN 25.918965 22.864285 NaN 65.108621 65.960714 04:00:00 NaN 25.978571 23.108929 NaN 64.525000 66.139285 04:30:00 NaN 25.794736 23.110527 NaN 65.349123 66.324561 val_idxmax=df_pivot[['temperature', 'humidity']].apply(pd.Series.idxmax) val_max=df_pivot[['temperature', 'humidity']].apply(pd.Series.max) df_concat = pd.concat([val_idxmax, val_max], axis=1).reset_index().pivot(index='date', columns='level_0') df_concat 0 1 level_0 humidity temperature humidity temperature date 2022-07-06 18:30:00 17:00:00 67.537736 28.174419 2022-07-07 07:30:00 17:00:00 70.470175 28.641072 2022-07-08 05:00:00 17:30:00 70.805263 27.100000 mi = pd.MultiIndex.from_product([['humidity', 'temperature'], ['timeat', 'value']]) rows=[] for idx, row in df_concat.iterrows(): t = [row[idx][variable] for variable in ['humidity', 'temperature'] for idx in [0,1] ] rows.append([idx] + t) df_new = pd.DataFrame.from_records(rows) df_new=df_new.set_index(0) df_new.index.rename('date', inplace=True) df_new.columns = mi df_new humidity temperature timeat value timeat value date 2022-07-06 18:30:00 67.537736 17:00:00 28.174419 2022-07-07 07:30:00 70.470175 17:00:00 28.641072 2022-07-08 05:00:00 70.805263 17:30:00 27.100000 time_range = pd.timedelta_range(start='1 day', end='2 days', freq='3H') fig, axs = plt.subplots(2,1, sharex=True, figsize=(10, 8)) df_pivot=df_resampled.pivot(index='time', columns='date') a=df_pivot['temperature'].plot(title='Temperature', ylabel='Temperature (*C)', ax=axs[0], legend=True) df_pivot=df_resampled.pivot(index='time', columns='date') df_pivot['humidity'].plot(ax=axs[1], title='Humidity', ylabel='Humidity (%)', legend=True) # plt.legend([a.lines]) plt.tight_layout() plt.savefig('temp-humid-bedroom.png', transparent=False, facecolor='white') Finding the daily extremes # Simple dictionary for formatting the unit of measurement that will be printed d_form = {'temperature': '*C', 'humidity': '%'} # Grouping by day for idx, day_g in df_resampled.groupby('date'): print(f'Date: {idx}') # Maximum # idxmax returns the position of the maximum value aggr_i = day_g[['temperature', 'humidity']].aggregate(pd.Series.idxmax) aggr_m = day_g[['temperature', 'humidity']].aggregate(pd.Series.max) # Putting the values together for pretty printing df_t=pd.concat([aggr_i, aggr_m], axis=1) for i, val in df_t.iterrows(): print(f'Max {i:\u003e12} = {val[1]:.1f} {d_form[i]:\u003e2} at {val[0].time()}') # Minimum # idxmax returns the position of the maximum value aggr_i = day_g[['temperature', 'humidity']].aggregate(pd.Series.idxmin) aggr_m = day_g[['temperature', 'humidity']].aggregate(pd.Series.min) # Putting the values together for pretty printing df_t=pd.concat([aggr_i, aggr_m], axis=1) for i, val in df_t.iterrows(): print(f'Min {i:\u003e12} = {val[1]:.1f} {d_form[i]:\u003e2} at {val[0].time()}') Date: 2022-07-06 Max temperature = 28.2 *C at 17:00:00 Max humidity = 67.5 % at 18:30:00 Min temperature = 26.7 *C at 21:30:00 Min humidity = 60.8 % at 22:00:00 Date: 2022-07-07 Max temperature = 28.6 *C at 17:00:00 Max humidity = 70.5 % at 07:30:00 Min temperature = 24.4 *C at 23:00:00 Min humidity = 58.5 % at 23:30:00 Date: 2022-07-08 Max temperature = 27.1 *C at 17:30:00 Max humidity = 70.8 % at 05:00:00 Min temperature = 21.7 *C at 05:00:00 Min humidity = 60.2 % at 00:00:00 Part 3: Concluding Let’s wrap up the post by summarizing what was shown, then making some observations.\nOverall, this was an interesting exercise to play around with timeseries, which is a format I haven’t really considered during my PhD. I had to figure out how to handle them using the functions provided by pandas, then how to use matplotlib to prepare the graphs while getting around the shortcomings of my data-gathering setup. In particular, seaborn was far more stubborn than I expected and I wasn’t able to find a proper way of wrangling the correct plots with the library.\nRegarding the actual data, it’s interesting to see the differences between the readings coming from the two locations. They were gathered over different time periods, and it was far hotter while I was recording the temperature in the attic: this makes direct comparisons not very meaningful, due to how different the external conditions were. Still, the difference in readings between the room and the attic can be explained by the fact that there is no activity in the attic; on the other hand, the sensor in the bedroom picked up on both my activity there: this involved the use of a desktop PC and multiple monitors and additional devices, coupled with the fact that windows can generate a noticeable breeze that goes through the entire top floor of the building. This goes to show that a good ventilato helps a lot with cooling down a hot interior, and that electronic devices work directly against that!\nI’m still working on building a different temperature sensor, and possibly something more complex that would allow to gather further information (a weather station maybe?), so I will definitely come back to this subject at some point in the future.\nAppendix: Other (unsuccessful) attempts In this section I’m gathering some additional methods I tried while working on the points shown above. I’m adding these both as a note to myself of what doesn’t work, and for readers to see what can happen while trying stuff out.\nFrom my understanding, part of the reason why these methods did not work quite as well as I hoped is due to the fact that I’m working with datetime objects, rather than “regular” indexing. This results in some funky behavior in some cases.\nPlotting struggles The pandas.DataFrame.melt function allows to obtain a “long form” version of a dataframe that pivots around some columns, while keeping other columns as variables. This can be extremely useful for plotting different variables on the same plot using libraries such as seaborn, which is what I will be trying in a moment.\ndf_melted = df_resampled.melt(id_vars=['time', 'date'], value_vars=['temperature']) df_melted['time'] = df_melted['time'].apply(datetime.time.isoformat) display(df_melted) # df_melted = df_melted.sort_values(['date', 'time']) time date variable value 0 14:30:00 2022-07-13 temperature 31.266667 1 15:00:00 2022-07-13 temperature 32.048214 2 15:30:00 2022-07-13 temperature 32.547368 3 16:00:00 2022-07-13 temperature 32.926316 4 16:30:00 2022-07-13 temperature 33.198245 ... ... ... ... ... 147 16:00:00 2022-07-16 temperature 35.548214 148 16:30:00 2022-07-16 temperature 35.810526 149 17:00:00 2022-07-16 temperature 35.903573 150 17:30:00 2022-07-16 temperature 35.987719 151 18:00:00 2022-07-16 temperature 36.000000 152 rows × 4 columns\nA “melted” dataframe can be plotted fairly easily using a command such as the one below. Besides the x- and y-axes, it is possible to distinguish the lines by hue (in this case, different colors for different dates) and by style (different line style for different variables). Here, it does not make a lot of sense to plot humidity and temperature in the same plot, but it is useful for the sake of the example.\nSomething else to note in the plot below is that the x-axis starts at 14:30, then continues for 24 hours until 14:00 the next day: this is due to the fact that the data captured by the log is incomplete for the day of 2022-07-13. After searching around for a while, I wasn’t able to reset the ticks on the x-axis to make them work properly, so I had to look for some workarounds.\nIndeed, the current plot shows a pretty major inconsistency at 0:00, which is when the date shifts from July 13th to July 14th, which is also why the orange line “jumps” below and seems to be a continuation of the blue line: this is exactly what that is!\nfig = plt.figure(figsize=(12,4)) ax = sns.lineplot(data = df_melted, x='time', y='value', hue='date', style='variable') ax.tick_params(rotation=90) It is possible to build a plot by using the full datetime object, rather than splitting by day, and the result is shown below:\ndf_melted = df_resampled.reset_index().melt(id_vars=['datetime'], value_vars=['temperature']) display(df_melted) fig = plt.figure(figsize=(12,4)) ax = sns.lineplot(data = df_melted, x='datetime', y='value') ax.tick_params(rotation=90) datetime variable value 0 2022-07-13 14:30:00 temperature 31.266667 1 2022-07-13 15:00:00 temperature 32.048214 2 2022-07-13 15:30:00 temperature 32.547368 3 2022-07-13 16:00:00 temperature 32.926316 4 2022-07-13 16:30:00 temperature 33.198245 ... ... ... ... 147 2022-07-16 16:00:00 temperature 35.548214 148 2022-07-16 16:30:00 temperature 35.810526 149 2022-07-16 17:00:00 temperature 35.903573 150 2022-07-16 17:30:00 temperature 35.987719 151 2022-07-16 18:00:00 temperature 36.000000 152 rows × 3 columns\nNow, this plot looks much clearer, however it’s not exactly what I wanted. For this reason, I decided to get rid of the offending data series (i.e. the incomplete series of readings from the first day) and plot the data for the remaining days. This isn’t really the best way of doing it, which is why I went for the solution in the first section of this post, but it gets the job done at least.\nSo, now my objective is selecting only the readings that start after the first day has ended, which can be done using either one of the two commands below, whose output is exactly the same.\ndf_resampled.index returns the index of the dataframe, which is in datetime format: this allows to compare it with a different datetime object that I am declaring (either fromisoformat(...) or date(...)). The comparison allows to find the datetime indices that occur after the given value, and keep only those.\ndf_1 =df_resampled.loc[df_resampled.index \u003e= datetime.datetime.fromisoformat('2022-07-14 00:00:00')] df_2 =df_resampled.loc[df_resampled.index.date \u003e datetime.date(2022, 7,13)] # Checking that the two indices are equal all(df_1.index == df_2.index) True Now that there is a cleaner dataframe to plot, the usual lineplot function can be used to prepare the temperature and humidity comparisons. |\ndf_melted = df_1.melt(id_vars=['time', 'date'], value_vars=['temperature'], value_name='temp') df_melted['time'] = df_melted['time'].apply(datetime.time.isoformat) df_melted = df_melted.sort_values(['date', 'time']) fig = plt.figure(figsize=(10,4)) ax = sns.lineplot(data = df_melted, x='time', y='temp', hue='date') ax.tick_params(rotation=90) df_melted = df_1.melt(id_vars=['time', 'date'], value_vars=['humidity'], value_name='hum') df_melted['time'] = df_melted['time'].apply(datetime.time.isoformat) df_melted = df_melted.sort_values(['date', 'time']) fig = plt.figure(figsize=(10,4)) ax = sns.lineplot(data = df_melted, x='time', y='hum', hue='date') ax.tick_params(rotation=90) Extracting extremes After splitting the readings on a day-by-day basis using pivot, I looked for a way of getting the extremes using the same table. Turns out, this was far more complex than I thought, especially for printing them in an easy-to-read way.\nLet’s start by taking a look at df_pivot again:\ndisplay(df_pivot.head()) temperature humidity date 2022-07-13 2022-07-14 2022-07-15 2022-07-16 2022-07-13 2022-07-14 2022-07-15 2022-07-16 time 00:00:00 NaN 29.640351 31.483636 31.187500 NaN 44.256141 41.012727 38.969643 00:30:00 NaN 29.321428 31.041071 30.917544 NaN 44.341071 40.332143 38.903509 01:00:00 NaN 29.025000 30.600000 30.540741 NaN 44.517857 40.024561 39.196297 01:30:00 NaN 28.775000 30.238182 30.076786 NaN 44.776786 39.936363 39.655357 02:00:00 NaN 28.519298 29.961403 29.866071 NaN 44.966667 40.045614 39.594642 This dataframe has a two-level header, with one half of the column covering the temperature on different days, and the other half recording humidity in the same periods of time. The index is a timeseries (not a datetime anymore, since the date is recorded in the columns).\n# Extracting the extremes and saving them in dataframes val_idxmax=df_pivot[['temperature', 'humidity']].apply(pd.Series.idxmax) val_max=df_pivot[['temperature', 'humidity']].apply(pd.Series.max) # Concatenating dataframes df_concat = pd.concat([val_idxmax, val_max], axis=1).reset_index().pivot(index='date', columns='level_0') df_concat 0 1 level_0 humidity temperature humidity temperature date 2022-07-13 14:30:00 18:00:00 49.774510 33.494737 2022-07-14 10:30:00 18:00:00 47.358182 35.562499 2022-07-15 10:00:00 16:00:00 43.696364 36.289285 2022-07-16 09:00:00 18:00:00 51.060715 36.000000 The result above kind of works, but is not very understandable: on the left, we have the time at which the extreme was measured and on the right we have the actual measured value.\nIt would be nicer to have a format similar to the original df_pivot, with temperature and humidity on top and the two variables timeat and measured value below. This can be done using a MultiIndex, which in this case I am building with the function .from_product. This function executes the cartesian product of the iterables passed as inputs and produces a MultiIndex object where each iterable represents a level in the multiindex.\nmi = pd.MultiIndex.from_product([['humidity', 'temperature'], ['timeat', 'value']]) mi MultiIndex([( 'humidity', 'timeat'), ( 'humidity', 'value'), ('temperature', 'timeat'), ('temperature', 'value')], ) At this point, I was looking for a way of massaging the columns and the index in order to make them match the multiindex, and this is what I came up with. Pretty ugly, but it works.\nFor each row in df_concat, I select the two columns of the multiindex (timeat and value, with labels 0 and 1 respectively), and then the specific variable (either humidity or temperature), so that the content of the list is:\n[row[timeat][humidity], row[value, humidity], row[timeat][temperature], row[value][temperature]] Finally, I add the index (i.e. the date) to the list, then I build the dataframe starting from those records. In the new dataframe, the index is then set to use the date column added to the list.\nThis is one way of printing the values, however I later realized that this makes actual pretty printing far more difficult, and the entire process thus far was quite clunky and “unpythonic”, which is why I decided to something else.\nrows=[] for idx, row in df_concat.iterrows(): t = [row[i_][variable] for variable in ['humidity', 'temperature'] for i_ in [0,1] ] rows.append([idx] + t) df_new = pd.DataFrame.from_records(rows) df_new=df_new.set_index(0) df_new.index.rename('date', inplace=True) df_new.columns = mi df_new humidity temperature timeat value timeat value date 2022-07-13 14:30:00 49.774510 18:00:00 33.494737 2022-07-14 10:30:00 47.358182 18:00:00 35.562499 2022-07-15 10:00:00 43.696364 16:00:00 36.289285 2022-07-16 09:00:00 51.060715 18:00:00 36.000000 ","wordCount":"3620","inLanguage":"en","image":"https://rcap107.github.io/%3Cimage%20path/url%3E","datePublished":"2022-07-17T00:06:04+02:00","dateModified":"2022-07-17T00:06:04+02:00","author":{"@type":"Person","name":"Riccardo Cappuzzo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rcap107.github.io/posts/raspberry/study-temperature/"},"publisher":{"@type":"Organization","name":"A blog by RicCap","logo":{"@type":"ImageObject","url":"https://rcap107.github.io/logo.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://rcap107.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://rcap107.github.io/logo.png alt aria-label=logo height=30>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://rcap107.github.io/posts/about-me/ title=about><span>about</span></a></li><li><a href=https://rcap107.github.io/publications/ title=publications><span>publications</span></a></li><li><a href=https://rcap107.github.io/posts/archives title=archive><span>archive</span></a></li><li><a href=https://rcap107.github.io title=rcap107.github.io><span>rcap107.github.io</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://rcap107.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://rcap107.github.io/posts/>Main Subjects</a>&nbsp;»&nbsp;<a href=https://rcap107.github.io/posts/raspberry/>Playing with IoT devices</a></div><h1 class="post-title entry-hint-parent">Studying the temperature readings</h1><div class=post-meta><span title='2022-07-17 00:06:04 +0200 +0200'>July 17, 2022</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;Riccardo Cappuzzo&nbsp;|&nbsp;<a href=https://github.com/rcap107.github.io/content/posts/raspberry/study-temperature.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><ul><li><a href=#notes-on-plots-and-dataframes aria-label="Notes on plots and dataframes">Notes on plots and dataframes</a></li></ul></ul><li><a href=#plotting-temperature-and-humidity-sensor-readings-with-matplotlib aria-label="Plotting temperature and humidity sensor readings with matplotlib">Plotting temperature and humidity sensor readings with matplotlib</a><ul><ul><li><a href=#libraries aria-label=Libraries>Libraries</a></li></ul><li><a href=#part-1-the-attic aria-label="Part 1: the attic">Part 1: the attic</a><ul><li><a href=#reading-and-cleaning-the-data aria-label="Reading and cleaning the data">Reading and cleaning the data</a></li><li><a href=#plotting-results-by-day aria-label="Plotting results by day">Plotting results by day</a></li><li><a href=#finding-the-daily-extremes aria-label="Finding the daily extremes">Finding the daily extremes</a></li></ul></li><li><a href=#part-2-the-bedroom aria-label="Part 2: the bedroom">Part 2: the bedroom</a><ul><li><a href=#plotting-results-by-day-1 aria-label="Plotting results by day">Plotting results by day</a></li><li><a href=#finding-the-daily-extremes-1 aria-label="Finding the daily extremes">Finding the daily extremes</a></li></ul></li><li><a href=#part-3-concluding aria-label="Part 3: Concluding">Part 3: Concluding</a></li><li><a href=#appendix--other-unsuccessful-attempts aria-label="Appendix:  Other (unsuccessful) attempts">Appendix: Other (unsuccessful) attempts</a><ul><li><a href=#plotting-struggles aria-label="Plotting struggles">Plotting struggles</a></li><li><a href=#extracting-extremes aria-label="Extracting extremes">Extracting extremes</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h3 id=notes-on-plots-and-dataframes>Notes on plots and dataframes<a hidden class=anchor aria-hidden=true href=#notes-on-plots-and-dataframes>#</a></h3><p>Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using <code>nbconvert</code>. As it turns out, the default output format used by <code>nbconvert</code> to display dataframes isn&rsquo;t rendered correctly by the Hugo backend I&rsquo;m using for the blog. I was not able to find a &ldquo;clean&rdquo; solution for it, so for this post (and until I&rsquo;ll find the actual fix) all tables are represented in raw html, rather than in a more decent format. I also need to figure out a better way of saving the plots, which allow to specify a <code>facecolor</code>, so that figures have a white background both in light and dark mode. For the time being, it&rsquo;s possible to switch to light mode to fix that particular problem.</p><p>The <code>nbconvert</code>-generated version of this post is also available <a href=/posts/raspberry/study-temperature-auto>here</a>.</p><h1 id=plotting-temperature-and-humidity-sensor-readings-with-matplotlib>Plotting temperature and humidity sensor readings with matplotlib<a hidden class=anchor aria-hidden=true href=#plotting-temperature-and-humidity-sensor-readings-with-matplotlib>#</a></h1><p>In this notebook, I will take a look at the readings from a DHT22 temperature-humidity sensor that I have left for a few days in a couple of locations in my house. As I&rsquo;m writing this, we&rsquo;re in the middle of the summer and there&rsquo;s a heatwave going on, so the average temperatures will be <em>pretty high</em>.</p><p>By gathering data over the course of different days and by varying some conditions (e.g. opening certain windows), I&rsquo;m hoping to find what&rsquo;s the best way of cooling down the house at night, and keeping it cool during the day.</p><h3 id=libraries>Libraries<a hidden class=anchor aria-hidden=true href=#libraries>#</a></h3><p>Let&rsquo;s start by talking about the libraries. Nothing pretty fancy here. <code>pandas</code> is there to put all the log readings into a dataframe, <code>matplotlib</code> and <code>seaborn</code> are graph visualization libraries for plotting data and <code>datetime</code> is there because I am working with timeseries. <code>matplotlib.dates</code> is used to customize some of the plotting parameters when handling dates.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>seaborn</span> <span class=k>as</span> <span class=nn>sns</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.dates</span> <span class=k>as</span> <span class=nn>mdates</span>
</span></span></code></pre></div><h2 id=part-1-the-attic>Part 1: the attic<a hidden class=anchor aria-hidden=true href=#part-1-the-attic>#</a></h2><h3 id=reading-and-cleaning-the-data>Reading and cleaning the data<a hidden class=anchor aria-hidden=true href=#reading-and-cleaning-the-data>#</a></h3><p>The temperature/humidity readings are stored in a csv file, together with the timestamp of the reading. Let&rsquo;s start with the readings coming from the sensor left in the attic.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;log.txt&#39;</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>,</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>])</span>
</span></span></code></pre></div><p>The next few commands are there for turning the datetime into a more manageable format, which helps with plotting later. In particular, since the <code>date</code> and <code>time</code> columns are read as strings, the following lines convert them back into datetime format.</p><p>Then, the two are combined back into a singular <code>datetime</code> object for each row, with the entire timestamp.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;datetime&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>([</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>combine</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span><span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>],</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>])])</span>
</span></span></code></pre></div><p>Now that I have a unique <code>datetime</code> index for every row, I can reset the index of the dataframe so that it uses the timestamp, rather than the regular ID.</p><p>The next step is resampling the timeline in order to reduce the number of readings, and to reduce the effect of anomalous readings. In this example, readings are grouped every 30 minutes, then they are aggregated by using the <code>mean</code> function.</p><p>Out of curiosity, and following a procedure I am not completely sure of, I am trying to plot the variance of the measurement over the same interval of time by aggregating with <code>var</code>, then plotting using the <code>fill_between</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Resetting the index so that it uses the datetime, then aggregating according to mean and variance. </span>
</span></span><span class=line><span class=cl><span class=n>df_resampled</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;30Min&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_var</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;30Min&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>var</span><span class=p>()</span>
</span></span></code></pre></div><p>Time for the first plots. Here, I am plotting all the readings from the moment I activated the process, to the moment I saved it on disk to study the readings. To better distinguish between days, I am searching for the timestamps with time <code>(0,0)</code> (i.e. midnight), then I&rsquo;m saving them in the variable <code>midnight</code>.</p><p>The command <code>df_resampled.index.time==datetime.time(0,0)</code> looks in the <code>.time</code> attribute of the datetime objects in the index and checks if the value contained therein is the same as <code>datetime.time(0,0)</code>.</p><p>The first plot will show the timeseries of temperature and humidity, along with their (supposed) error bars. Since I&rsquo;m using the same code for plotting both temperature and humidity, I wrote a simple function that takes as input the dataframe and the variable of interest, then prepares the resulting plot.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>plot_overall_var</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>tgt_var</span><span class=p>,</span> <span class=n>df_var</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_bounds</span><span class=p>(</span><span class=n>df_base</span><span class=p>,</span> <span class=n>df_var</span><span class=p>,</span> <span class=n>column</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#39;&#39;Preparing the upper and lower bounds by adding the variance
</span></span></span><span class=line><span class=cl><span class=s1>        &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>y1</span> <span class=o>=</span> <span class=n>df_base</span><span class=p>[</span><span class=n>column</span><span class=p>]</span> <span class=o>+</span> <span class=n>df_var</span><span class=p>[</span><span class=n>column</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>y2</span> <span class=o>=</span> <span class=n>df_base</span><span class=p>[</span><span class=n>column</span><span class=p>]</span> <span class=o>-</span> <span class=n>df_var</span><span class=p>[</span><span class=n>column</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>y1</span><span class=p>,</span><span class=n>y2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Setting the size of the figure</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plotting the main line</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>lineplot</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=n>df_resampled</span><span class=p>[</span><span class=n>tgt_var</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=n>tgt_var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># If provided, adding the variance</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>df_var</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>yhigh</span><span class=p>,</span> <span class=n>ylow</span> <span class=o>=</span> <span class=n>get_bounds</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=n>df_var</span><span class=p>,</span> <span class=n>tgt_var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plt</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> <span class=n>ylow</span><span class=p>,</span> <span class=n>yhigh</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;orange&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plotting vertical lines for highlighting the change of date</span>
</span></span><span class=line><span class=cl>    <span class=n>midnight</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>time</span><span class=o>==</span><span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>)]</span><span class=o>.</span><span class=n>index</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>day</span> <span class=ow>in</span> <span class=n>midnight</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plt</span><span class=o>.</span><span class=n>axvline</span><span class=p>(</span><span class=n>day</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=c1># Plotting ticks every 3 hours</span>
</span></span><span class=line><span class=cl>    <span class=n>_</span> <span class=o>=</span> <span class=n>ax</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_major_locator</span><span class=p>(</span><span class=n>mdates</span><span class=o>.</span><span class=n>HourLocator</span><span class=p>(</span><span class=n>interval</span><span class=o>=</span><span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Rotating the ticks</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>xaxis</span><span class=o>.</span><span class=n>set_tick_params</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Tightening the result</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plot_overall_var</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=n>df_var</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plot_overall_var</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>,</span> <span class=n>df_var</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_15_0.png alt=png>
<img loading=lazy src=/images/study-temperature_files/study-temperature_15_1.png alt=png></p><h3 id=plotting-results-by-day>Plotting results by day<a hidden class=anchor aria-hidden=true href=#plotting-results-by-day>#</a></h3><p>In the next section, I will reshape the data with the objective of comparing the readings gathered in different days, to look for potential similarities and differences. To do so, I&rsquo;ll first split the <code>datetime</code> index into columns <code>date</code> and <code>time</code>, then I will pivot the table so that the new index will be <code>time</code>, and the columns will report temperature and humidity for each day. As you&rsquo;ll notice, a bunch of values are missing and get with the value <code>NaN</code>: this is due to the fact that I started the data collection around 14h on July 13th.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_resampled</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>date</span>
</span></span><span class=line><span class=cl><span class=n>df_resampled</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Displaying only the first 10 rows</span>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=4 halign=left>temperature</th><th colspan=4 halign=left>humidity</th></tr><tr><th>date</th><th>2022-07-13</th><th>2022-07-14</th><th>2022-07-15</th><th>2022-07-16</th><th>2022-07-13</th><th>2022-07-14</th><th>2022-07-15</th><th>2022-07-16</th></tr><tr><th>time</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>00:00:00</th><td>NaN</td><td>29.640351</td><td>31.483636</td><td>31.187500</td><td>NaN</td><td>44.256141</td><td>41.012727</td><td>38.969643</td></tr><tr><th>00:30:00</th><td>NaN</td><td>29.321428</td><td>31.041071</td><td>30.917544</td><td>NaN</td><td>44.341071</td><td>40.332143</td><td>38.903509</td></tr><tr><th>01:00:00</th><td>NaN</td><td>29.025000</td><td>30.600000</td><td>30.540741</td><td>NaN</td><td>44.517857</td><td>40.024561</td><td>39.196297</td></tr><tr><th>01:30:00</th><td>NaN</td><td>28.775000</td><td>30.238182</td><td>30.076786</td><td>NaN</td><td>44.776786</td><td>39.936363</td><td>39.655357</td></tr><tr><th>02:00:00</th><td>NaN</td><td>28.519298</td><td>29.961403</td><td>29.866071</td><td>NaN</td><td>44.966667</td><td>40.045614</td><td>39.594642</td></tr><tr><th>02:30:00</th><td>NaN</td><td>28.323214</td><td>29.657143</td><td>29.710527</td><td>NaN</td><td>44.798214</td><td>39.983929</td><td>40.035088</td></tr><tr><th>03:00:00</th><td>NaN</td><td>28.083929</td><td>29.340000</td><td>29.500000</td><td>NaN</td><td>44.835714</td><td>39.558182</td><td>40.560714</td></tr><tr><th>03:30:00</th><td>NaN</td><td>27.839286</td><td>29.054386</td><td>29.285714</td><td>NaN</td><td>45.023214</td><td>39.131579</td><td>42.167857</td></tr><tr><th>04:00:00</th><td>NaN</td><td>27.514286</td><td>28.794643</td><td>29.000000</td><td>NaN</td><td>45.291072</td><td>39.330357</td><td>44.741072</td></tr><tr><th>04:30:00</th><td>NaN</td><td>27.251786</td><td>28.581818</td><td>28.656364</td><td>NaN</td><td>45.671428</td><td>40.038182</td><td>45.830909</td></tr></tbody></table></div><p>Here I&rsquo;m plotting the values of temperature and humidity recorded on each day.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>time_range</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>timedelta_range</span><span class=p>(</span><span class=n>start</span><span class=o>=</span><span class=s1>&#39;1 day&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;2 days&#39;</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s1>&#39;3H&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axs</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span> <span class=n>sharex</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=n>df_pivot</span><span class=p>[</span><span class=s1>&#39;temperature&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s1>&#39;Temperature&#39;</span><span class=p>,</span> <span class=n>ylabel</span><span class=o>=</span><span class=s1>&#39;Temperature (*C)&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>legend</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=p>[</span><span class=s1>&#39;humidity&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ax</span><span class=o>=</span><span class=n>axs</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>title</span><span class=o>=</span><span class=s1>&#39;Humidity&#39;</span><span class=p>,</span> <span class=n>ylabel</span><span class=o>=</span><span class=s1>&#39;Humidity (%)&#39;</span><span class=p>,</span> <span class=n>legend</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># plt.legend([a.lines])</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s1>&#39;temp-humid-attic.png&#39;</span><span class=p>,</span> <span class=n>transparent</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>facecolor</span><span class=o>=</span><span class=s1>&#39;white&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_21_0.png alt=png></p><h3 id=finding-the-daily-extremes>Finding the daily extremes<a hidden class=anchor aria-hidden=true href=#finding-the-daily-extremes>#</a></h3><p>In this section, I will be parsing the data and look for the daily extremes (maximum and minimum) for temperature and humidity, and the time at which they occurred.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Simple dictionary for formatting the unit of measurement that will be printed</span>
</span></span><span class=line><span class=cl><span class=n>d_form</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;temperature&#39;</span><span class=p>:</span> <span class=s1>&#39;*C&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>:</span> <span class=s1>&#39;%&#39;</span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Grouping by day</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>day_g</span> <span class=ow>in</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;date&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Date: </span><span class=si>{</span><span class=n>idx</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>#     Maximum</span>
</span></span><span class=line><span class=cl><span class=c1>#     idxmax returns the position of the maximum value</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_i</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>idxmax</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_m</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#     Putting the values together for pretty printing</span>
</span></span><span class=line><span class=cl>    <span class=n>df_t</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>aggr_i</span><span class=p>,</span> <span class=n>aggr_m</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>df_t</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Max </span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s1>&gt;12</span><span class=si>}</span><span class=s1> = </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s1>.1f</span><span class=si>}</span><span class=s1> </span><span class=si>{</span><span class=n>d_form</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=si>:</span><span class=s1>&gt;2</span><span class=si>}</span><span class=s1> at </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=c1>#     Minimum</span>
</span></span><span class=line><span class=cl><span class=c1>#     idxmax returns the position of the maximum value</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_i</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>idxmin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_m</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>min</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#     Putting the values together for pretty printing</span>
</span></span><span class=line><span class=cl>    <span class=n>df_t</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>aggr_i</span><span class=p>,</span> <span class=n>aggr_m</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>df_t</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Min </span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s1>&gt;12</span><span class=si>}</span><span class=s1> = </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s1>.1f</span><span class=si>}</span><span class=s1> </span><span class=si>{</span><span class=n>d_form</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=si>:</span><span class=s1>&gt;2</span><span class=si>}</span><span class=s1> at </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>Date: 2022-07-13
Max  temperature = 33.5 *C at 18:00:00
Max     humidity = 49.8  % at 14:30:00
Min  temperature = 30.0 *C at 23:30:00
Min     humidity = 42.6  % at 18:30:00
Date: 2022-07-14
Max  temperature = 35.6 *C at 18:00:00
Max     humidity = 47.4  % at 10:30:00
Min  temperature = 26.4 *C at 07:30:00
Min     humidity = 38.8  % at 19:00:00
Date: 2022-07-15
Max  temperature = 36.3 *C at 16:00:00
Max     humidity = 43.7  % at 10:00:00
Min  temperature = 27.6 *C at 07:00:00
Min     humidity = 33.4  % at 16:00:00
Date: 2022-07-16
Max  temperature = 36.0 *C at 18:00:00
Max     humidity = 51.1  % at 09:00:00
Min  temperature = 27.7 *C at 07:30:00
Min     humidity = 38.9  % at 00:30:00
</code></pre><h2 id=part-2-the-bedroom>Part 2: the bedroom<a hidden class=anchor aria-hidden=true href=#part-2-the-bedroom>#</a></h2><p>In this section, I will be repeating most of what was done in Part 1: the main difference will be the location of the sensor. Rather than keeping it in the attic, in fact, I was keeping this on the desk in my bedroom. In particular, the sensor was exposed to the heat coming from a pretty chonky desktop PC, as well as two monitors, and it is positioned close to a window.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;readings-room.csv&#39;</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>,</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span><span class=p>[</span><span class=s1>&#39;datetime&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>([</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>combine</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span><span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>],</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>])])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Resetting the index so that it uses the datetime, then aggregating according to mean and variance. </span>
</span></span><span class=line><span class=cl><span class=n>df_resampled</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;30Min&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_var</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s1>&#39;datetime&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;30Min&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>var</span><span class=p>()</span>
</span></span></code></pre></div><p>Below, I&rsquo;m plotting the overall temperature and humidity readings. Unlike in the case of the attic, however, the variance is far more larger, which leads to a plot that is almost unreadable in the case of humidity. For this reason, I am also plotting the graphs without added bands by calling <code>plot_overall_var</code> without the <code>df_var</code> variable.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>plot_overall_var</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=n>df_var</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plot_overall_var</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>,</span> <span class=n>df_var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plot_overall_var</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plot_overall_var</span><span class=p>(</span><span class=n>df_resampled</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_32_0.png alt=png></p><p><img loading=lazy src=/images/study-temperature_files/study-temperature_32_1.png alt=png></p><p><img loading=lazy src=/images/study-temperature_files/study-temperature_32_2.png alt=png></p><p><img loading=lazy src=/images/study-temperature_files/study-temperature_32_3.png alt=png></p><h3 id=plotting-results-by-day-1>Plotting results by day<a hidden class=anchor aria-hidden=true href=#plotting-results-by-day-1>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_resampled</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>date</span>
</span></span><span class=line><span class=cl><span class=n>df_resampled</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Displaying only the first 10 rows</span>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=3 halign=left>temperature</th><th colspan=3 halign=left>humidity</th></tr><tr><th>date</th><th>2022-07-06</th><th>2022-07-07</th><th>2022-07-08</th><th>2022-07-06</th><th>2022-07-07</th><th>2022-07-08</th></tr><tr><th>time</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>00:00:00</th><td>NaN</td><td>NaN</td><td>24.601786</td><td>NaN</td><td>NaN</td><td>60.225000</td></tr><tr><th>00:30:00</th><td>NaN</td><td>26.792857</td><td>23.985965</td><td>NaN</td><td>62.985715</td><td>61.821053</td></tr><tr><th>01:00:00</th><td>NaN</td><td>26.937255</td><td>23.458929</td><td>NaN</td><td>62.368627</td><td>63.941071</td></tr><tr><th>01:30:00</th><td>NaN</td><td>26.825000</td><td>22.831579</td><td>NaN</td><td>62.901786</td><td>66.178947</td></tr><tr><th>02:00:00</th><td>NaN</td><td>26.421053</td><td>21.867273</td><td>NaN</td><td>63.638596</td><td>69.143637</td></tr><tr><th>02:30:00</th><td>NaN</td><td>26.396428</td><td>22.728572</td><td>NaN</td><td>64.705357</td><td>65.946429</td></tr><tr><th>03:00:00</th><td>NaN</td><td>26.171930</td><td>22.787719</td><td>NaN</td><td>64.521053</td><td>64.991228</td></tr><tr><th>03:30:00</th><td>NaN</td><td>25.918965</td><td>22.864285</td><td>NaN</td><td>65.108621</td><td>65.960714</td></tr><tr><th>04:00:00</th><td>NaN</td><td>25.978571</td><td>23.108929</td><td>NaN</td><td>64.525000</td><td>66.139285</td></tr><tr><th>04:30:00</th><td>NaN</td><td>25.794736</td><td>23.110527</td><td>NaN</td><td>65.349123</td><td>66.324561</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>val_idxmax</span><span class=o>=</span><span class=n>df_pivot</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>idxmax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>val_max</span><span class=o>=</span><span class=n>df_pivot</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>max</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_concat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>val_idxmax</span><span class=p>,</span> <span class=n>val_max</span><span class=p>],</span>  <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;level_0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_concat</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=2 halign=left>0</th><th colspan=2 halign=left>1</th></tr><tr><th>level_0</th><th>humidity</th><th>temperature</th><th>humidity</th><th>temperature</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2022-07-06</th><td>18:30:00</td><td>17:00:00</td><td>67.537736</td><td>28.174419</td></tr><tr><th>2022-07-07</th><td>07:30:00</td><td>17:00:00</td><td>70.470175</td><td>28.641072</td></tr><tr><th>2022-07-08</th><td>05:00:00</td><td>17:30:00</td><td>70.805263</td><td>27.100000</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mi</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>MultiIndex</span><span class=o>.</span><span class=n>from_product</span><span class=p>([[</span><span class=s1>&#39;humidity&#39;</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;timeat&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>]])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>rows</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>df_concat</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=n>idx</span><span class=p>][</span><span class=n>variable</span><span class=p>]</span>  <span class=k>for</span> <span class=n>variable</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;humidity&#39;</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>]</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>idx</span><span class=p>]</span> <span class=o>+</span> <span class=n>t</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_new</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_records</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span><span class=o>=</span><span class=n>df_new</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=n>mi</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=2 halign=left>humidity</th><th colspan=2 halign=left>temperature</th></tr><tr><th></th><th>timeat</th><th>value</th><th>timeat</th><th>value</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2022-07-06</th><td>18:30:00</td><td>67.537736</td><td>17:00:00</td><td>28.174419</td></tr><tr><th>2022-07-07</th><td>07:30:00</td><td>70.470175</td><td>17:00:00</td><td>28.641072</td></tr><tr><th>2022-07-08</th><td>05:00:00</td><td>70.805263</td><td>17:30:00</td><td>27.100000</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>time_range</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>timedelta_range</span><span class=p>(</span><span class=n>start</span><span class=o>=</span><span class=s1>&#39;1 day&#39;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;2 days&#39;</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s1>&#39;3H&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axs</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span> <span class=n>sharex</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=n>df_pivot</span><span class=p>[</span><span class=s1>&#39;temperature&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s1>&#39;Temperature&#39;</span><span class=p>,</span> <span class=n>ylabel</span><span class=o>=</span><span class=s1>&#39;Temperature (*C)&#39;</span><span class=p>,</span> <span class=n>ax</span><span class=o>=</span><span class=n>axs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>legend</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_pivot</span><span class=p>[</span><span class=s1>&#39;humidity&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ax</span><span class=o>=</span><span class=n>axs</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>title</span><span class=o>=</span><span class=s1>&#39;Humidity&#39;</span><span class=p>,</span> <span class=n>ylabel</span><span class=o>=</span><span class=s1>&#39;Humidity (%)&#39;</span><span class=p>,</span> <span class=n>legend</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># plt.legend([a.lines])</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s1>&#39;temp-humid-bedroom.png&#39;</span><span class=p>,</span> <span class=n>transparent</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>facecolor</span><span class=o>=</span><span class=s1>&#39;white&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_41_0.png alt=png></p><h3 id=finding-the-daily-extremes-1>Finding the daily extremes<a hidden class=anchor aria-hidden=true href=#finding-the-daily-extremes-1>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Simple dictionary for formatting the unit of measurement that will be printed</span>
</span></span><span class=line><span class=cl><span class=n>d_form</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;temperature&#39;</span><span class=p>:</span> <span class=s1>&#39;*C&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>:</span> <span class=s1>&#39;%&#39;</span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Grouping by day</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>day_g</span> <span class=ow>in</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;date&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Date: </span><span class=si>{</span><span class=n>idx</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>#     Maximum</span>
</span></span><span class=line><span class=cl><span class=c1>#     idxmax returns the position of the maximum value</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_i</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>idxmax</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_m</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>max</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#     Putting the values together for pretty printing</span>
</span></span><span class=line><span class=cl>    <span class=n>df_t</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>aggr_i</span><span class=p>,</span> <span class=n>aggr_m</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>df_t</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Max </span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s1>&gt;12</span><span class=si>}</span><span class=s1> = </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s1>.1f</span><span class=si>}</span><span class=s1> </span><span class=si>{</span><span class=n>d_form</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=si>:</span><span class=s1>&gt;2</span><span class=si>}</span><span class=s1> at </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=c1>#     Minimum</span>
</span></span><span class=line><span class=cl><span class=c1>#     idxmax returns the position of the maximum value</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_i</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>idxmin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>aggr_m</span> <span class=o>=</span> <span class=n>day_g</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>aggregate</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>min</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#     Putting the values together for pretty printing</span>
</span></span><span class=line><span class=cl>    <span class=n>df_t</span><span class=o>=</span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>aggr_i</span><span class=p>,</span> <span class=n>aggr_m</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>df_t</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Min </span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s1>&gt;12</span><span class=si>}</span><span class=s1> = </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s1>.1f</span><span class=si>}</span><span class=s1> </span><span class=si>{</span><span class=n>d_form</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=si>:</span><span class=s1>&gt;2</span><span class=si>}</span><span class=s1> at </span><span class=si>{</span><span class=n>val</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>time</span><span class=p>()</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>Date: 2022-07-06
Max  temperature = 28.2 *C at 17:00:00
Max     humidity = 67.5  % at 18:30:00
Min  temperature = 26.7 *C at 21:30:00
Min     humidity = 60.8  % at 22:00:00
Date: 2022-07-07
Max  temperature = 28.6 *C at 17:00:00
Max     humidity = 70.5  % at 07:30:00
Min  temperature = 24.4 *C at 23:00:00
Min     humidity = 58.5  % at 23:30:00
Date: 2022-07-08
Max  temperature = 27.1 *C at 17:30:00
Max     humidity = 70.8  % at 05:00:00
Min  temperature = 21.7 *C at 05:00:00
Min     humidity = 60.2  % at 00:00:00
</code></pre><h2 id=part-3-concluding>Part 3: Concluding<a hidden class=anchor aria-hidden=true href=#part-3-concluding>#</a></h2><p>Let&rsquo;s wrap up the post by summarizing what was shown, then making some observations.</p><p>Overall, this was an interesting exercise to play around with timeseries, which is a format I haven&rsquo;t really considered during my PhD. I had to figure out how to handle them using the functions provided by <code>pandas</code>, then how to use <code>matplotlib</code> to prepare the graphs while getting around the shortcomings of my data-gathering setup. In particular, <code>seaborn</code> was far more stubborn than I expected and I wasn&rsquo;t able to find a proper way of wrangling the correct plots with the library.</p><p>Regarding the actual data, it&rsquo;s interesting to see the differences between the readings coming from the two locations. They were gathered over different time periods, and it was far hotter while I was recording the temperature in the attic: this makes direct comparisons not very meaningful, due to how different the external conditions were. Still, the difference in readings between the room and the attic can be explained by the fact that there is no activity in the attic; on the other hand, the sensor in the bedroom picked up on both my activity there: this involved the use of a desktop PC and multiple monitors and additional devices, coupled with the fact that windows can generate a noticeable breeze that goes through the entire top floor of the building. This goes to show that a good ventilato helps a lot with cooling down a hot interior, and that electronic devices work directly against that!</p><p>I&rsquo;m still working on building a different temperature sensor, and possibly something more complex that would allow to gather further information (a weather station maybe?), so I will definitely come back to this subject at some point in the future.</p><h2 id=appendix--other-unsuccessful-attempts>Appendix: Other (unsuccessful) attempts<a hidden class=anchor aria-hidden=true href=#appendix--other-unsuccessful-attempts>#</a></h2><p>In this section I&rsquo;m gathering some additional methods I tried while working on the points shown above. I&rsquo;m adding these both as a note to myself of what <em>doesn&rsquo;t work</em>, and for readers to see what can happen while trying stuff out.</p><p>From my understanding, part of the reason why these methods did not work quite as well as I hoped is due to the fact that I&rsquo;m working with datetime objects, rather than &ldquo;regular&rdquo; indexing. This results in some funky behavior in some cases.</p><h3 id=plotting-struggles>Plotting struggles<a hidden class=anchor aria-hidden=true href=#plotting-struggles>#</a></h3><p>The <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html#pandas.melt>pandas.DataFrame.melt</a> function allows to obtain a &ldquo;long form&rdquo; version of a dataframe that pivots around some columns, while keeping other columns as variables. This can be extremely useful for plotting different variables on the same plot using libraries such as <code>seaborn</code>, which is what I will be trying in a moment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_melted</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>melt</span><span class=p>(</span><span class=n>id_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=s1>&#39;date&#39;</span><span class=p>],</span> <span class=n>value_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;temperature&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>df_melted</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>isoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>display</span><span class=p>(</span><span class=n>df_melted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># df_melted = df_melted.sort_values([&#39;date&#39;, &#39;time&#39;])</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>time</th><th>date</th><th>variable</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>14:30:00</td><td>2022-07-13</td><td>temperature</td><td>31.266667</td></tr><tr><th>1</th><td>15:00:00</td><td>2022-07-13</td><td>temperature</td><td>32.048214</td></tr><tr><th>2</th><td>15:30:00</td><td>2022-07-13</td><td>temperature</td><td>32.547368</td></tr><tr><th>3</th><td>16:00:00</td><td>2022-07-13</td><td>temperature</td><td>32.926316</td></tr><tr><th>4</th><td>16:30:00</td><td>2022-07-13</td><td>temperature</td><td>33.198245</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>147</th><td>16:00:00</td><td>2022-07-16</td><td>temperature</td><td>35.548214</td></tr><tr><th>148</th><td>16:30:00</td><td>2022-07-16</td><td>temperature</td><td>35.810526</td></tr><tr><th>149</th><td>17:00:00</td><td>2022-07-16</td><td>temperature</td><td>35.903573</td></tr><tr><th>150</th><td>17:30:00</td><td>2022-07-16</td><td>temperature</td><td>35.987719</td></tr><tr><th>151</th><td>18:00:00</td><td>2022-07-16</td><td>temperature</td><td>36.000000</td></tr></tbody></table><p>152 rows × 4 columns</p></div><p>A &ldquo;melted&rdquo; dataframe can be plotted fairly easily using a command such as the one below. Besides the x- and y-axes, it is possible to distinguish the lines by hue (in this case, different colors for different dates) and by style (different line style for different variables). Here, it does not make a lot of sense to plot humidity and temperature in the same plot, but it is useful for the sake of the example.</p><p>Something else to note in the plot below is that the x-axis starts at 14:30, then continues for 24 hours until 14:00 the next day: this is due to the fact that the data captured by the log is incomplete for the day of 2022-07-13. After searching around for a while, I wasn&rsquo;t able to reset the ticks on the x-axis to make them work properly, so I had to look for some workarounds.</p><p>Indeed, the current plot shows a pretty major inconsistency at 0:00, which is when the date shifts from July 13th to July 14th, which is also why the orange line &ldquo;jumps&rdquo; below and seems to be a continuation of the blue line: this is exactly what that is!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>lineplot</span><span class=p>(</span><span class=n>data</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s1>&#39;variable&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>tick_params</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>90</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_53_0.png alt=png></p><p>It is possible to build a plot by using the full <code>datetime</code> object, rather than splitting by day, and the result is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_melted</span> <span class=o>=</span> <span class=n>df_resampled</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>melt</span><span class=p>(</span><span class=n>id_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;datetime&#39;</span><span class=p>],</span> <span class=n>value_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;temperature&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>display</span><span class=p>(</span><span class=n>df_melted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>lineplot</span><span class=p>(</span><span class=n>data</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;datetime&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;value&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>tick_params</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>90</span><span class=p>)</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>datetime</th><th>variable</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>2022-07-13 14:30:00</td><td>temperature</td><td>31.266667</td></tr><tr><th>1</th><td>2022-07-13 15:00:00</td><td>temperature</td><td>32.048214</td></tr><tr><th>2</th><td>2022-07-13 15:30:00</td><td>temperature</td><td>32.547368</td></tr><tr><th>3</th><td>2022-07-13 16:00:00</td><td>temperature</td><td>32.926316</td></tr><tr><th>4</th><td>2022-07-13 16:30:00</td><td>temperature</td><td>33.198245</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td></tr><tr><th>147</th><td>2022-07-16 16:00:00</td><td>temperature</td><td>35.548214</td></tr><tr><th>148</th><td>2022-07-16 16:30:00</td><td>temperature</td><td>35.810526</td></tr><tr><th>149</th><td>2022-07-16 17:00:00</td><td>temperature</td><td>35.903573</td></tr><tr><th>150</th><td>2022-07-16 17:30:00</td><td>temperature</td><td>35.987719</td></tr><tr><th>151</th><td>2022-07-16 18:00:00</td><td>temperature</td><td>36.000000</td></tr></tbody></table><p>152 rows × 3 columns</p></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_55_1.png alt=png></p><p>Now, this plot looks much clearer, however it&rsquo;s not exactly what I wanted. For this reason, I decided to get rid of the offending data series (i.e. the incomplete series of readings from the first day) and plot the data for the remaining days. This isn&rsquo;t really the best way of doing it, which is why I went for the solution in the first section of this post, but it gets the job done at least.</p><p>So, now my objective is selecting only the readings that start after the first day has ended, which can be done using either one of the two commands below, whose output is exactly the same.</p><p><code>df_resampled.index</code> returns the index of the dataframe, which is in datetime format: this allows to compare it with a different datetime object that I am declaring (either <code>fromisoformat(...)</code> or <code>date(...)</code>). The comparison allows to find the datetime indices that occur after the given value, and keep only those.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_1</span> <span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span> <span class=o>&gt;=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>(</span><span class=s1>&#39;2022-07-14 00:00:00&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_2</span> <span class=o>=</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_resampled</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>date</span> <span class=o>&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=p>(</span><span class=mi>2022</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span><span class=mi>13</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Checking that the two indices are equal</span>
</span></span><span class=line><span class=cl><span class=nb>all</span><span class=p>(</span><span class=n>df_1</span><span class=o>.</span><span class=n>index</span> <span class=o>==</span> <span class=n>df_2</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>True
</code></pre><p>Now that there is a cleaner dataframe to plot, the usual <code>lineplot</code> function can be used to prepare the temperature and humidity comparisons. |</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_melted</span> <span class=o>=</span> <span class=n>df_1</span><span class=o>.</span><span class=n>melt</span><span class=p>(</span><span class=n>id_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=s1>&#39;date&#39;</span><span class=p>],</span> <span class=n>value_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;temperature&#39;</span><span class=p>],</span> <span class=n>value_name</span><span class=o>=</span><span class=s1>&#39;temp&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_melted</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>isoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_melted</span> <span class=o>=</span> <span class=n>df_melted</span><span class=o>.</span><span class=n>sort_values</span><span class=p>([</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=s1>&#39;time&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>lineplot</span><span class=p>(</span><span class=n>data</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;temp&#39;</span><span class=p>,</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>tick_params</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>90</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=study-temperature_files/study-temperature_60_0.png alt=png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_melted</span> <span class=o>=</span> <span class=n>df_1</span><span class=o>.</span><span class=n>melt</span><span class=p>(</span><span class=n>id_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=s1>&#39;date&#39;</span><span class=p>],</span> <span class=n>value_vars</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;humidity&#39;</span><span class=p>],</span> <span class=n>value_name</span><span class=o>=</span><span class=s1>&#39;hum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_melted</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>[</span><span class=s1>&#39;time&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=o>.</span><span class=n>isoformat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_melted</span> <span class=o>=</span> <span class=n>df_melted</span><span class=o>.</span><span class=n>sort_values</span><span class=p>([</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=s1>&#39;time&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span> <span class=o>=</span> <span class=n>sns</span><span class=o>.</span><span class=n>lineplot</span><span class=p>(</span><span class=n>data</span> <span class=o>=</span> <span class=n>df_melted</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;time&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;hum&#39;</span><span class=p>,</span> <span class=n>hue</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=o>.</span><span class=n>tick_params</span><span class=p>(</span><span class=n>rotation</span><span class=o>=</span><span class=mi>90</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/study-temperature_files/study-temperature_61_0.png alt=png></p><h3 id=extracting-extremes>Extracting extremes<a hidden class=anchor aria-hidden=true href=#extracting-extremes>#</a></h3><p>After splitting the readings on a day-by-day basis using <code>pivot</code>, I looked for a way of getting the extremes using the same table. Turns out, this was far more complex than I thought, especially for printing them in an easy-to-read way.</p><p>Let&rsquo;s start by taking a look at <code>df_pivot</code> again:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>display</span><span class=p>(</span><span class=n>df_pivot</span><span class=o>.</span><span class=n>head</span><span class=p>())</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=4 halign=left>temperature</th><th colspan=4 halign=left>humidity</th></tr><tr><th>date</th><th>2022-07-13</th><th>2022-07-14</th><th>2022-07-15</th><th>2022-07-16</th><th>2022-07-13</th><th>2022-07-14</th><th>2022-07-15</th><th>2022-07-16</th></tr><tr><th>time</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>00:00:00</th><td>NaN</td><td>29.640351</td><td>31.483636</td><td>31.187500</td><td>NaN</td><td>44.256141</td><td>41.012727</td><td>38.969643</td></tr><tr><th>00:30:00</th><td>NaN</td><td>29.321428</td><td>31.041071</td><td>30.917544</td><td>NaN</td><td>44.341071</td><td>40.332143</td><td>38.903509</td></tr><tr><th>01:00:00</th><td>NaN</td><td>29.025000</td><td>30.600000</td><td>30.540741</td><td>NaN</td><td>44.517857</td><td>40.024561</td><td>39.196297</td></tr><tr><th>01:30:00</th><td>NaN</td><td>28.775000</td><td>30.238182</td><td>30.076786</td><td>NaN</td><td>44.776786</td><td>39.936363</td><td>39.655357</td></tr><tr><th>02:00:00</th><td>NaN</td><td>28.519298</td><td>29.961403</td><td>29.866071</td><td>NaN</td><td>44.966667</td><td>40.045614</td><td>39.594642</td></tr></tbody></table></div><p>This dataframe has a two-level header, with one half of the column covering the temperature on different days, and the other half recording humidity in the same periods of time. The index is a timeseries (not a datetime anymore, since the date is recorded in the columns).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Extracting the extremes and saving them in dataframes</span>
</span></span><span class=line><span class=cl><span class=n>val_idxmax</span><span class=o>=</span><span class=n>df_pivot</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>idxmax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>val_max</span><span class=o>=</span><span class=n>df_pivot</span><span class=p>[[</span><span class=s1>&#39;temperature&#39;</span><span class=p>,</span> <span class=s1>&#39;humidity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=o>.</span><span class=n>max</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Concatenating dataframes</span>
</span></span><span class=line><span class=cl><span class=n>df_concat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>val_idxmax</span><span class=p>,</span> <span class=n>val_max</span><span class=p>],</span>  <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span><span class=o>.</span><span class=n>pivot</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=s1>&#39;level_0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_concat</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=2 halign=left>0</th><th colspan=2 halign=left>1</th></tr><tr><th>level_0</th><th>humidity</th><th>temperature</th><th>humidity</th><th>temperature</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2022-07-13</th><td>14:30:00</td><td>18:00:00</td><td>49.774510</td><td>33.494737</td></tr><tr><th>2022-07-14</th><td>10:30:00</td><td>18:00:00</td><td>47.358182</td><td>35.562499</td></tr><tr><th>2022-07-15</th><td>10:00:00</td><td>16:00:00</td><td>43.696364</td><td>36.289285</td></tr><tr><th>2022-07-16</th><td>09:00:00</td><td>18:00:00</td><td>51.060715</td><td>36.000000</td></tr></tbody></table></div><p>The result above kind of works, but is not very understandable: on the left, we have the <em>time at which the extreme was measured</em> and on the right we have the actual measured value.</p><p>It would be nicer to have a format similar to the original <code>df_pivot</code>, with temperature and humidity on top and the two variables <code>timeat</code> and <code>measured value</code> below. This can be done using a <code>MultiIndex</code>, which in this case I am building with the function <code>.from_product</code>. This function executes the cartesian product of the iterables passed as inputs and produces a MultiIndex object where each iterable represents a level in the multiindex.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mi</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>MultiIndex</span><span class=o>.</span><span class=n>from_product</span><span class=p>([[</span><span class=s1>&#39;humidity&#39;</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;timeat&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>]])</span>
</span></span><span class=line><span class=cl><span class=n>mi</span>
</span></span></code></pre></div><pre><code>MultiIndex([(   'humidity', 'timeat'),
            (   'humidity',  'value'),
            ('temperature', 'timeat'),
            ('temperature',  'value')],
           )
</code></pre><p>At this point, I was looking for a way of massaging the columns and the index in order to make them match the multiindex, and this is what I came up with. Pretty ugly, but it works.</p><p>For each row in <code>df_concat</code>, I select the two columns of the multiindex (<code>timeat</code> and <code>value</code>, with labels 0 and 1 respectively), and then the specific variable (either humidity or temperature), so that the content of the list is:</p><pre tabindex=0><code>[row[timeat][humidity], row[value, humidity], row[timeat][temperature], row[value][temperature]]
</code></pre><p>Finally, I add the index (i.e. the date) to the list, then I build the dataframe starting from those records. In the new dataframe, the index is then set to use the <code>date</code> column added to the list.</p><p>This is one way of printing the values, however I later realized that this makes actual pretty printing far more difficult, and the entire process thus far was quite clunky and &ldquo;unpythonic&rdquo;, which is why I decided to something else.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>rows</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>df_concat</span><span class=o>.</span><span class=n>iterrows</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=n>i_</span><span class=p>][</span><span class=n>variable</span><span class=p>]</span>  <span class=k>for</span> <span class=n>variable</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;humidity&#39;</span><span class=p>,</span> <span class=s1>&#39;temperature&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i_</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>]</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>idx</span><span class=p>]</span> <span class=o>+</span> <span class=n>t</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_new</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_records</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span><span class=o>=</span><span class=n>df_new</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=n>mi</span>
</span></span><span class=line><span class=cl><span class=n>df_new</span>
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead tr th{text-align:left}.dataframe thead tr:last-of-type th{text-align:right}</style><table border=1 class=dataframe><thead><tr><th></th><th colspan=2 halign=left>humidity</th><th colspan=2 halign=left>temperature</th></tr><tr><th></th><th>timeat</th><th>value</th><th>timeat</th><th>value</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2022-07-13</th><td>14:30:00</td><td>49.774510</td><td>18:00:00</td><td>33.494737</td></tr><tr><th>2022-07-14</th><td>10:30:00</td><td>47.358182</td><td>18:00:00</td><td>35.562499</td></tr><tr><th>2022-07-15</th><td>10:00:00</td><td>43.696364</td><td>16:00:00</td><td>36.289285</td></tr><tr><th>2022-07-16</th><td>09:00:00</td><td>51.060715</td><td>18:00:00</td><td>36.000000</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://rcap107.github.io/tags/raspberry/>Raspberry</a></li><li><a href=https://rcap107.github.io/tags/iot/>IoT</a></li></ul><nav class=paginav><a class=prev href=https://rcap107.github.io/posts/raspberry/study-temperature-auto/><span class=title>« Prev</span><br><span>Studying the thermometer readings and playing with timeseries in Python</span>
</a><a class=next href=https://rcap107.github.io/posts/raspberry/the_setup/><span class=title>Next »</span><br><span>The setup</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://rcap107.github.io/>A blog by RicCap</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
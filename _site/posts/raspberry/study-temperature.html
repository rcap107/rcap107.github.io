<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-07-17">

<title>Studying the temperature readings – A blog by RC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d7ba9c6adfd1938aed2b9fb196500684.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-51e2c66856be53ee965980e392a92cdf.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">A blog by RC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/about-me/pubs.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rcap107/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/riccardocappuzzo.com"> <i class="bi bi-bluesky" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Studying the temperature readings</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">raspberry</div>
                <div class="quarto-category">IoT</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 17, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="notes-on-plots-and-dataframes" class="level3">
<h3 class="anchored" data-anchor-id="notes-on-plots-and-dataframes">Notes on plots and dataframes</h3>
<p>Before we begin, a couple of notes on plots dataframes: this post has been prepared by converting a jupyter notebook into a markdown file using <code>nbconvert</code>. As it turns out, the default output format used by <code>nbconvert</code> to display dataframes isn’t rendered correctly by the Hugo backend I’m using for the blog. I was not able to find a “clean” solution for it, so for this post (and until I’ll find the actual fix) all tables are represented in raw html, rather than in a more decent format. I also need to figure out a better way of saving the plots, which allow to specify a <code>facecolor</code>, so that figures have a white background both in light and dark mode. For the time being, it’s possible to switch to light mode to fix that particular problem.</p>
<p>The <code>nbconvert</code>-generated version of this post is also available <a href="../../posts/raspberry/study-temperature-auto">here</a>.</p>
</section>
<section id="plotting-temperature-and-humidity-sensor-readings-with-matplotlib" class="level1">
<h1>Plotting temperature and humidity sensor readings with matplotlib</h1>
<p>In this notebook, I will take a look at the readings from a DHT22 temperature-humidity sensor that I have left for a few days in a couple of locations in my house. As I’m writing this, we’re in the middle of the summer and there’s a heatwave going on, so the average temperatures will be <em>pretty high</em>.</p>
<p>By gathering data over the course of different days and by varying some conditions (e.g.&nbsp;opening certain windows), I’m hoping to find what’s the best way of cooling down the house at night, and keeping it cool during the day.</p>
<section id="libraries" class="level3">
<h3 class="anchored" data-anchor-id="libraries">Libraries</h3>
<p>Let’s start by talking about the libraries. Nothing pretty fancy here. <code>pandas</code> is there to put all the log readings into a dataframe, <code>matplotlib</code> and <code>seaborn</code> are graph visualization libraries for plotting data and <code>datetime</code> is there because I am working with timeseries. <code>matplotlib.dates</code> is used to customize some of the plotting parameters when handling dates.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="part-1-the-attic" class="level2">
<h2 class="anchored" data-anchor-id="part-1-the-attic">Part 1: the attic</h2>
<section id="reading-and-cleaning-the-data" class="level3">
<h3 class="anchored" data-anchor-id="reading-and-cleaning-the-data">Reading and cleaning the data</h3>
<p>The temperature/humidity readings are stored in a csv file, together with the timestamp of the reading. Let’s start with the readings coming from the sensor left in the attic.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'log.txt'</span>, header<span class="op">=</span><span class="dv">0</span>, names<span class="op">=</span>[<span class="st">'date'</span>,<span class="st">'time'</span>, <span class="st">'temperature'</span>, <span class="st">'humidity'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The next few commands are there for turning the datetime into a more manageable format, which helps with plotting later. In particular, since the <code>date</code> and <code>time</code> columns are read as strings, the following lines convert them back into datetime format.</p>
<p>Then, the two are combined back into a singular <code>datetime</code> object for each row, with the entire timestamp.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'time'</span>] <span class="op">=</span> df[<span class="st">'time'</span>].<span class="bu">apply</span>(datetime.time.fromisoformat)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].<span class="bu">apply</span>(datetime.date.fromisoformat)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'datetime'</span>] <span class="op">=</span> pd.to_datetime([datetime.datetime.combine(a, b) <span class="cf">for</span> a,b <span class="kw">in</span> <span class="bu">zip</span>(df[<span class="st">'date'</span>], df[<span class="st">'time'</span>])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that I have a unique <code>datetime</code> index for every row, I can reset the index of the dataframe so that it uses the timestamp, rather than the regular ID.</p>
<p>The next step is resampling the timeline in order to reduce the number of readings, and to reduce the effect of anomalous readings. In this example, readings are grouped every 30 minutes, then they are aggregated by using the <code>mean</code> function.</p>
<p>Out of curiosity, and following a procedure I am not completely sure of, I am trying to plot the variance of the measurement over the same interval of time by aggregating with <code>var</code>, then plotting using the <code>fill_between</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resetting the index so that it uses the datetime, then aggregating according to mean and variance. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_resampled <span class="op">=</span> df.set_index(<span class="st">'datetime'</span>).resample(<span class="st">'30Min'</span>).mean()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df_var <span class="op">=</span> df.set_index(<span class="st">'datetime'</span>).resample(<span class="st">'30Min'</span>).var()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Time for the first plots. Here, I am plotting all the readings from the moment I activated the process, to the moment I saved it on disk to study the readings. To better distinguish between days, I am searching for the timestamps with time <code>(0,0)</code> (i.e.&nbsp;midnight), then I’m saving them in the variable <code>midnight</code>.</p>
<p>The command <code>df_resampled.index.time==datetime.time(0,0)</code> looks in the <code>.time</code> attribute of the datetime objects in the index and checks if the value contained therein is the same as <code>datetime.time(0,0)</code>.</p>
<p>The first plot will show the timeseries of temperature and humidity, along with their (supposed) error bars. Since I’m using the same code for plotting both temperature and humidity, I wrote a simple function that takes as input the dataframe and the variable of interest, then prepares the resulting plot.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_overall_var(df, tgt_var, df_var<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_bounds(df_base, df_var, column):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">'''Preparing the upper and lower bounds by adding the variance</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">        '''</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        y1 <span class="op">=</span> df_base[column] <span class="op">+</span> df_var[column]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        y2 <span class="op">=</span> df_base[column] <span class="op">-</span> df_var[column]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> y1,y2</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Setting the size of the figure</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">4</span>))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotting the main line</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.lineplot(x<span class="op">=</span>df_resampled.index, y<span class="op">=</span>df_resampled[tgt_var])</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    plt.title(tgt_var)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If provided, adding the variance</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_var <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        yhigh, ylow <span class="op">=</span> get_bounds(df_resampled, df_var, tgt_var)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        plt.fill_between(df_resampled.index, ylow, yhigh, color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotting vertical lines for highlighting the change of date</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    midnight <span class="op">=</span> df_resampled.loc[df_resampled.index.time<span class="op">==</span>datetime.time(<span class="dv">0</span>,<span class="dv">0</span>)].index</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> day <span class="kw">in</span> midnight:</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        plt.axvline(day)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotting ticks every 3 hours</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> ax.xaxis.set_major_locator(mdates.HourLocator(interval<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rotating the ticks</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_tick_params(rotation<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tightening the result</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>plot_overall_var(df_resampled, <span class="st">'temperature'</span>, df_var)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>plot_overall_var(df_resampled, <span class="st">'humidity'</span>, df_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../../images/study-temperature_files/study-temperature_15_0.png" class="img-fluid" alt="png"> <img src="../../images/study-temperature_files/study-temperature_15_1.png" class="img-fluid" alt="png"></p>
</section>
<section id="plotting-results-by-day" class="level3">
<h3 class="anchored" data-anchor-id="plotting-results-by-day">Plotting results by day</h3>
<p>In the next section, I will reshape the data with the objective of comparing the readings gathered in different days, to look for potential similarities and differences. To do so, I’ll first split the <code>datetime</code> index into columns <code>date</code> and <code>time</code>, then I will pivot the table so that the new index will be <code>time</code>, and the columns will report temperature and humidity for each day. As you’ll notice, a bunch of values are missing and get with the value <code>NaN</code>: this is due to the fact that I started the data collection around 14h on July 13th.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_resampled[<span class="st">'date'</span>] <span class="op">=</span> df_resampled.index.date</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_resampled[<span class="st">'time'</span>] <span class="op">=</span> df_resampled.index.time</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df_pivot<span class="op">=</span>df_resampled.pivot(index<span class="op">=</span><span class="st">'time'</span>, columns<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying only the first 10 rows</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df_pivot.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="4" halign="left">
temperature
</th>
<th colspan="4" halign="left">
humidity
</th>
</tr>
<tr>
<th>
date
</th>
<th>
2022-07-13
</th>
<th>
2022-07-14
</th>
<th>
2022-07-15
</th>
<th>
2022-07-16
</th>
<th>
2022-07-13
</th>
<th>
2022-07-14
</th>
<th>
2022-07-15
</th>
<th>
2022-07-16
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
00:00:00
</th>
<td>
NaN
</td>
<td>
29.640351
</td>
<td>
31.483636
</td>
<td>
31.187500
</td>
<td>
NaN
</td>
<td>
44.256141
</td>
<td>
41.012727
</td>
<td>
38.969643
</td>
</tr>
<tr>
<th>
00:30:00
</th>
<td>
NaN
</td>
<td>
29.321428
</td>
<td>
31.041071
</td>
<td>
30.917544
</td>
<td>
NaN
</td>
<td>
44.341071
</td>
<td>
40.332143
</td>
<td>
38.903509
</td>
</tr>
<tr>
<th>
01:00:00
</th>
<td>
NaN
</td>
<td>
29.025000
</td>
<td>
30.600000
</td>
<td>
30.540741
</td>
<td>
NaN
</td>
<td>
44.517857
</td>
<td>
40.024561
</td>
<td>
39.196297
</td>
</tr>
<tr>
<th>
01:30:00
</th>
<td>
NaN
</td>
<td>
28.775000
</td>
<td>
30.238182
</td>
<td>
30.076786
</td>
<td>
NaN
</td>
<td>
44.776786
</td>
<td>
39.936363
</td>
<td>
39.655357
</td>
</tr>
<tr>
<th>
02:00:00
</th>
<td>
NaN
</td>
<td>
28.519298
</td>
<td>
29.961403
</td>
<td>
29.866071
</td>
<td>
NaN
</td>
<td>
44.966667
</td>
<td>
40.045614
</td>
<td>
39.594642
</td>
</tr>
<tr>
<th>
02:30:00
</th>
<td>
NaN
</td>
<td>
28.323214
</td>
<td>
29.657143
</td>
<td>
29.710527
</td>
<td>
NaN
</td>
<td>
44.798214
</td>
<td>
39.983929
</td>
<td>
40.035088
</td>
</tr>
<tr>
<th>
03:00:00
</th>
<td>
NaN
</td>
<td>
28.083929
</td>
<td>
29.340000
</td>
<td>
29.500000
</td>
<td>
NaN
</td>
<td>
44.835714
</td>
<td>
39.558182
</td>
<td>
40.560714
</td>
</tr>
<tr>
<th>
03:30:00
</th>
<td>
NaN
</td>
<td>
27.839286
</td>
<td>
29.054386
</td>
<td>
29.285714
</td>
<td>
NaN
</td>
<td>
45.023214
</td>
<td>
39.131579
</td>
<td>
42.167857
</td>
</tr>
<tr>
<th>
04:00:00
</th>
<td>
NaN
</td>
<td>
27.514286
</td>
<td>
28.794643
</td>
<td>
29.000000
</td>
<td>
NaN
</td>
<td>
45.291072
</td>
<td>
39.330357
</td>
<td>
44.741072
</td>
</tr>
<tr>
<th>
04:30:00
</th>
<td>
NaN
</td>
<td>
27.251786
</td>
<td>
28.581818
</td>
<td>
28.656364
</td>
<td>
NaN
</td>
<td>
45.671428
</td>
<td>
40.038182
</td>
<td>
45.830909
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<p>Here I’m plotting the values of temperature and humidity recorded on each day.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>time_range <span class="op">=</span> pd.timedelta_range(start<span class="op">=</span><span class="st">'1 day'</span>, end<span class="op">=</span><span class="st">'2 days'</span>, freq<span class="op">=</span><span class="st">'3H'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">1</span>, sharex<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_pivot<span class="op">=</span>df_resampled.pivot(index<span class="op">=</span><span class="st">'time'</span>, columns<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>df_pivot[<span class="st">'temperature'</span>].plot(title<span class="op">=</span><span class="st">'Temperature'</span>, ylabel<span class="op">=</span><span class="st">'Temperature (*C)'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>], legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df_pivot<span class="op">=</span>df_resampled.pivot(index<span class="op">=</span><span class="st">'time'</span>, columns<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df_pivot[<span class="st">'humidity'</span>].plot(ax<span class="op">=</span>axs[<span class="dv">1</span>], title<span class="op">=</span><span class="st">'Humidity'</span>, ylabel<span class="op">=</span><span class="st">'Humidity (%)'</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.legend([a.lines])</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'temp-humid-attic.png'</span>, transparent<span class="op">=</span><span class="va">False</span>, facecolor<span class="op">=</span><span class="st">'white'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_21_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="finding-the-daily-extremes" class="level3">
<h3 class="anchored" data-anchor-id="finding-the-daily-extremes">Finding the daily extremes</h3>
<p>In this section, I will be parsing the data and look for the daily extremes (maximum and minimum) for temperature and humidity, and the time at which they occurred.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple dictionary for formatting the unit of measurement that will be printed</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>d_form <span class="op">=</span> {<span class="st">'temperature'</span>: <span class="st">'*C'</span>, <span class="st">'humidity'</span>: <span class="st">'%'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouping by day</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, day_g <span class="kw">in</span> df_resampled.groupby(<span class="st">'date'</span>):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Date: </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     Maximum</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     idxmax returns the position of the maximum value</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    aggr_i <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.idxmax)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    aggr_m <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.<span class="bu">max</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     Putting the values together for pretty printing</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    df_t<span class="op">=</span>pd.concat([aggr_i, aggr_m], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, val <span class="kw">in</span> df_t.iterrows():</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Max </span><span class="sc">{</span>i<span class="sc">:&gt;12}</span><span class="ss"> = </span><span class="sc">{</span>val[<span class="dv">1</span>]<span class="sc">:.1f}</span><span class="ss"> </span><span class="sc">{</span>d_form[i]<span class="sc">:&gt;2}</span><span class="ss"> at </span><span class="sc">{</span>val[<span class="dv">0</span>]<span class="sc">.</span>time()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     Minimum</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     idxmax returns the position of the maximum value</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    aggr_i <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.idxmin)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    aggr_m <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.<span class="bu">min</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     Putting the values together for pretty printing</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    df_t<span class="op">=</span>pd.concat([aggr_i, aggr_m], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, val <span class="kw">in</span> df_t.iterrows():</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Min </span><span class="sc">{</span>i<span class="sc">:&gt;12}</span><span class="ss"> = </span><span class="sc">{</span>val[<span class="dv">1</span>]<span class="sc">:.1f}</span><span class="ss"> </span><span class="sc">{</span>d_form[i]<span class="sc">:&gt;2}</span><span class="ss"> at </span><span class="sc">{</span>val[<span class="dv">0</span>]<span class="sc">.</span>time()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Date: 2022-07-13
Max  temperature = 33.5 *C at 18:00:00
Max     humidity = 49.8  % at 14:30:00
Min  temperature = 30.0 *C at 23:30:00
Min     humidity = 42.6  % at 18:30:00
Date: 2022-07-14
Max  temperature = 35.6 *C at 18:00:00
Max     humidity = 47.4  % at 10:30:00
Min  temperature = 26.4 *C at 07:30:00
Min     humidity = 38.8  % at 19:00:00
Date: 2022-07-15
Max  temperature = 36.3 *C at 16:00:00
Max     humidity = 43.7  % at 10:00:00
Min  temperature = 27.6 *C at 07:00:00
Min     humidity = 33.4  % at 16:00:00
Date: 2022-07-16
Max  temperature = 36.0 *C at 18:00:00
Max     humidity = 51.1  % at 09:00:00
Min  temperature = 27.7 *C at 07:30:00
Min     humidity = 38.9  % at 00:30:00</code></pre>
</section>
</section>
<section id="part-2-the-bedroom" class="level2">
<h2 class="anchored" data-anchor-id="part-2-the-bedroom">Part 2: the bedroom</h2>
<p>In this section, I will be repeating most of what was done in Part 1: the main difference will be the location of the sensor. Rather than keeping it in the attic, in fact, I was keeping this on the desk in my bedroom. In particular, the sensor was exposed to the heat coming from a pretty chonky desktop PC, as well as two monitors, and it is positioned close to a window.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'readings-room.csv'</span>, header<span class="op">=</span><span class="dv">0</span>, names<span class="op">=</span>[<span class="st">'date'</span>,<span class="st">'time'</span>, <span class="st">'temperature'</span>, <span class="st">'humidity'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'time'</span>] <span class="op">=</span> df[<span class="st">'time'</span>].<span class="bu">apply</span>(datetime.time.fromisoformat)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> df[<span class="st">'date'</span>].<span class="bu">apply</span>(datetime.date.fromisoformat)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'datetime'</span>] <span class="op">=</span> pd.to_datetime([datetime.datetime.combine(a, b) <span class="cf">for</span> a,b <span class="kw">in</span> <span class="bu">zip</span>(df[<span class="st">'date'</span>], df[<span class="st">'time'</span>])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resetting the index so that it uses the datetime, then aggregating according to mean and variance. </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df_resampled <span class="op">=</span> df.set_index(<span class="st">'datetime'</span>).resample(<span class="st">'30Min'</span>).mean()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_var <span class="op">=</span> df.set_index(<span class="st">'datetime'</span>).resample(<span class="st">'30Min'</span>).var()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Below, I’m plotting the overall temperature and humidity readings. Unlike in the case of the attic, however, the variance is far more larger, which leads to a plot that is almost unreadable in the case of humidity. For this reason, I am also plotting the graphs without added bands by calling <code>plot_overall_var</code> without the <code>df_var</code> variable.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plot_overall_var(df_resampled, <span class="st">'temperature'</span>, df_var)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plot_overall_var(df_resampled, <span class="st">'humidity'</span>, df_var)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plot_overall_var(df_resampled, <span class="st">'temperature'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plot_overall_var(df_resampled, <span class="st">'humidity'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_32_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_32_1.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_32_2.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_32_3.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<section id="plotting-results-by-day-1" class="level3">
<h3 class="anchored" data-anchor-id="plotting-results-by-day-1">Plotting results by day</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_resampled[<span class="st">'date'</span>] <span class="op">=</span> df_resampled.index.date</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_resampled[<span class="st">'time'</span>] <span class="op">=</span> df_resampled.index.time</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>df_pivot<span class="op">=</span>df_resampled.pivot(index<span class="op">=</span><span class="st">'time'</span>, columns<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying only the first 10 rows</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df_pivot.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="3" halign="left">
temperature
</th>
<th colspan="3" halign="left">
humidity
</th>
</tr>
<tr>
<th>
date
</th>
<th>
2022-07-06
</th>
<th>
2022-07-07
</th>
<th>
2022-07-08
</th>
<th>
2022-07-06
</th>
<th>
2022-07-07
</th>
<th>
2022-07-08
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
00:00:00
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
24.601786
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
60.225000
</td>
</tr>
<tr>
<th>
00:30:00
</th>
<td>
NaN
</td>
<td>
26.792857
</td>
<td>
23.985965
</td>
<td>
NaN
</td>
<td>
62.985715
</td>
<td>
61.821053
</td>
</tr>
<tr>
<th>
01:00:00
</th>
<td>
NaN
</td>
<td>
26.937255
</td>
<td>
23.458929
</td>
<td>
NaN
</td>
<td>
62.368627
</td>
<td>
63.941071
</td>
</tr>
<tr>
<th>
01:30:00
</th>
<td>
NaN
</td>
<td>
26.825000
</td>
<td>
22.831579
</td>
<td>
NaN
</td>
<td>
62.901786
</td>
<td>
66.178947
</td>
</tr>
<tr>
<th>
02:00:00
</th>
<td>
NaN
</td>
<td>
26.421053
</td>
<td>
21.867273
</td>
<td>
NaN
</td>
<td>
63.638596
</td>
<td>
69.143637
</td>
</tr>
<tr>
<th>
02:30:00
</th>
<td>
NaN
</td>
<td>
26.396428
</td>
<td>
22.728572
</td>
<td>
NaN
</td>
<td>
64.705357
</td>
<td>
65.946429
</td>
</tr>
<tr>
<th>
03:00:00
</th>
<td>
NaN
</td>
<td>
26.171930
</td>
<td>
22.787719
</td>
<td>
NaN
</td>
<td>
64.521053
</td>
<td>
64.991228
</td>
</tr>
<tr>
<th>
03:30:00
</th>
<td>
NaN
</td>
<td>
25.918965
</td>
<td>
22.864285
</td>
<td>
NaN
</td>
<td>
65.108621
</td>
<td>
65.960714
</td>
</tr>
<tr>
<th>
04:00:00
</th>
<td>
NaN
</td>
<td>
25.978571
</td>
<td>
23.108929
</td>
<td>
NaN
</td>
<td>
64.525000
</td>
<td>
66.139285
</td>
</tr>
<tr>
<th>
04:30:00
</th>
<td>
NaN
</td>
<td>
25.794736
</td>
<td>
23.110527
</td>
<td>
NaN
</td>
<td>
65.349123
</td>
<td>
66.324561
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>val_idxmax<span class="op">=</span>df_pivot[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].<span class="bu">apply</span>(pd.Series.idxmax)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>val_max<span class="op">=</span>df_pivot[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].<span class="bu">apply</span>(pd.Series.<span class="bu">max</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_concat <span class="op">=</span> pd.concat([val_idxmax, val_max],  axis<span class="op">=</span><span class="dv">1</span>).reset_index().pivot(index<span class="op">=</span><span class="st">'date'</span>, columns<span class="op">=</span><span class="st">'level_0'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_concat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="2" halign="left">
0
</th>
<th colspan="2" halign="left">
1
</th>
</tr>
<tr>
<th>
level_0
</th>
<th>
humidity
</th>
<th>
temperature
</th>
<th>
humidity
</th>
<th>
temperature
</th>
</tr>
<tr>
<th>
date
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-07-06
</th>
<td>
18:30:00
</td>
<td>
17:00:00
</td>
<td>
67.537736
</td>
<td>
28.174419
</td>
</tr>
<tr>
<th>
2022-07-07
</th>
<td>
07:30:00
</td>
<td>
17:00:00
</td>
<td>
70.470175
</td>
<td>
28.641072
</td>
</tr>
<tr>
<th>
2022-07-08
</th>
<td>
05:00:00
</td>
<td>
17:30:00
</td>
<td>
70.805263
</td>
<td>
27.100000
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mi <span class="op">=</span> pd.MultiIndex.from_product([[<span class="st">'humidity'</span>, <span class="st">'temperature'</span>], [<span class="st">'timeat'</span>, <span class="st">'value'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rows<span class="op">=</span>[]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> df_concat.iterrows():</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> [row[idx][variable]  <span class="cf">for</span> variable <span class="kw">in</span> [<span class="st">'humidity'</span>, <span class="st">'temperature'</span>] <span class="cf">for</span> idx <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>] ]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    rows.append([idx] <span class="op">+</span> t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> pd.DataFrame.from_records(rows)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df_new<span class="op">=</span>df_new.set_index(<span class="dv">0</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df_new.index.rename(<span class="st">'date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df_new.columns <span class="op">=</span> mi</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="2" halign="left">
humidity
</th>
<th colspan="2" halign="left">
temperature
</th>
</tr>
<tr>
<th>
</th>
<th>
timeat
</th>
<th>
value
</th>
<th>
timeat
</th>
<th>
value
</th>
</tr>
<tr>
<th>
date
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-07-06
</th>
<td>
18:30:00
</td>
<td>
67.537736
</td>
<td>
17:00:00
</td>
<td>
28.174419
</td>
</tr>
<tr>
<th>
2022-07-07
</th>
<td>
07:30:00
</td>
<td>
70.470175
</td>
<td>
17:00:00
</td>
<td>
28.641072
</td>
</tr>
<tr>
<th>
2022-07-08
</th>
<td>
05:00:00
</td>
<td>
70.805263
</td>
<td>
17:30:00
</td>
<td>
27.100000
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>time_range <span class="op">=</span> pd.timedelta_range(start<span class="op">=</span><span class="st">'1 day'</span>, end<span class="op">=</span><span class="st">'2 days'</span>, freq<span class="op">=</span><span class="st">'3H'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">1</span>, sharex<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_pivot<span class="op">=</span>df_resampled.pivot(index<span class="op">=</span><span class="st">'time'</span>, columns<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>df_pivot[<span class="st">'temperature'</span>].plot(title<span class="op">=</span><span class="st">'Temperature'</span>, ylabel<span class="op">=</span><span class="st">'Temperature (*C)'</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>], legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df_pivot<span class="op">=</span>df_resampled.pivot(index<span class="op">=</span><span class="st">'time'</span>, columns<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df_pivot[<span class="st">'humidity'</span>].plot(ax<span class="op">=</span>axs[<span class="dv">1</span>], title<span class="op">=</span><span class="st">'Humidity'</span>, ylabel<span class="op">=</span><span class="st">'Humidity (%)'</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.legend([a.lines])</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'temp-humid-bedroom.png'</span>, transparent<span class="op">=</span><span class="va">False</span>, facecolor<span class="op">=</span><span class="st">'white'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_41_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="finding-the-daily-extremes-1" class="level3">
<h3 class="anchored" data-anchor-id="finding-the-daily-extremes-1">Finding the daily extremes</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple dictionary for formatting the unit of measurement that will be printed</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>d_form <span class="op">=</span> {<span class="st">'temperature'</span>: <span class="st">'*C'</span>, <span class="st">'humidity'</span>: <span class="st">'%'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouping by day</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, day_g <span class="kw">in</span> df_resampled.groupby(<span class="st">'date'</span>):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Date: </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     Maximum</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     idxmax returns the position of the maximum value</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    aggr_i <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.idxmax)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    aggr_m <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.<span class="bu">max</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     Putting the values together for pretty printing</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    df_t<span class="op">=</span>pd.concat([aggr_i, aggr_m], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, val <span class="kw">in</span> df_t.iterrows():</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Max </span><span class="sc">{</span>i<span class="sc">:&gt;12}</span><span class="ss"> = </span><span class="sc">{</span>val[<span class="dv">1</span>]<span class="sc">:.1f}</span><span class="ss"> </span><span class="sc">{</span>d_form[i]<span class="sc">:&gt;2}</span><span class="ss"> at </span><span class="sc">{</span>val[<span class="dv">0</span>]<span class="sc">.</span>time()<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     Minimum</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     idxmax returns the position of the maximum value</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    aggr_i <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.idxmin)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    aggr_m <span class="op">=</span> day_g[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].aggregate(pd.Series.<span class="bu">min</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     Putting the values together for pretty printing</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    df_t<span class="op">=</span>pd.concat([aggr_i, aggr_m], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, val <span class="kw">in</span> df_t.iterrows():</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Min </span><span class="sc">{</span>i<span class="sc">:&gt;12}</span><span class="ss"> = </span><span class="sc">{</span>val[<span class="dv">1</span>]<span class="sc">:.1f}</span><span class="ss"> </span><span class="sc">{</span>d_form[i]<span class="sc">:&gt;2}</span><span class="ss"> at </span><span class="sc">{</span>val[<span class="dv">0</span>]<span class="sc">.</span>time()<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Date: 2022-07-06
Max  temperature = 28.2 *C at 17:00:00
Max     humidity = 67.5  % at 18:30:00
Min  temperature = 26.7 *C at 21:30:00
Min     humidity = 60.8  % at 22:00:00
Date: 2022-07-07
Max  temperature = 28.6 *C at 17:00:00
Max     humidity = 70.5  % at 07:30:00
Min  temperature = 24.4 *C at 23:00:00
Min     humidity = 58.5  % at 23:30:00
Date: 2022-07-08
Max  temperature = 27.1 *C at 17:30:00
Max     humidity = 70.8  % at 05:00:00
Min  temperature = 21.7 *C at 05:00:00
Min     humidity = 60.2  % at 00:00:00</code></pre>
</section>
</section>
<section id="part-3-concluding" class="level2">
<h2 class="anchored" data-anchor-id="part-3-concluding">Part 3: Concluding</h2>
<p>Let’s wrap up the post by summarizing what was shown, then making some observations.</p>
<p>Overall, this was an interesting exercise to play around with timeseries, which is a format I haven’t really considered during my PhD. I had to figure out how to handle them using the functions provided by <code>pandas</code>, then how to use <code>matplotlib</code> to prepare the graphs while getting around the shortcomings of my data-gathering setup. In particular, <code>seaborn</code> was far more stubborn than I expected and I wasn’t able to find a proper way of wrangling the correct plots with the library.</p>
<p>Regarding the actual data, it’s interesting to see the differences between the readings coming from the two locations. They were gathered over different time periods, and it was far hotter while I was recording the temperature in the attic: this makes direct comparisons not very meaningful, due to how different the external conditions were. Still, the difference in readings between the room and the attic can be explained by the fact that there is no activity in the attic; on the other hand, the sensor in the bedroom picked up on both my activity there: this involved the use of a desktop PC and multiple monitors and additional devices, coupled with the fact that windows can generate a noticeable breeze that goes through the entire top floor of the building. This goes to show that a good ventilato helps a lot with cooling down a hot interior, and that electronic devices work directly against that!</p>
<p>I’m still working on building a different temperature sensor, and possibly something more complex that would allow to gather further information (a weather station maybe?), so I will definitely come back to this subject at some point in the future.</p>
</section>
<section id="appendix-other-unsuccessful-attempts" class="level2">
<h2 class="anchored" data-anchor-id="appendix-other-unsuccessful-attempts">Appendix: Other (unsuccessful) attempts</h2>
<p>In this section I’m gathering some additional methods I tried while working on the points shown above. I’m adding these both as a note to myself of what <em>doesn’t work</em>, and for readers to see what can happen while trying stuff out.</p>
<p>From my understanding, part of the reason why these methods did not work quite as well as I hoped is due to the fact that I’m working with datetime objects, rather than “regular” indexing. This results in some funky behavior in some cases.</p>
<section id="plotting-struggles" class="level3">
<h3 class="anchored" data-anchor-id="plotting-struggles">Plotting struggles</h3>
<p>The <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html#pandas.melt">pandas.DataFrame.melt</a> function allows to obtain a “long form” version of a dataframe that pivots around some columns, while keeping other columns as variables. This can be extremely useful for plotting different variables on the same plot using libraries such as <code>seaborn</code>, which is what I will be trying in a moment.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_resampled.melt(id_vars<span class="op">=</span>[<span class="st">'time'</span>, <span class="st">'date'</span>], value_vars<span class="op">=</span>[<span class="st">'temperature'</span>])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_melted[<span class="st">'time'</span>] <span class="op">=</span> df_melted[<span class="st">'time'</span>].<span class="bu">apply</span>(datetime.time.isoformat)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>display(df_melted)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df_melted = df_melted.sort_values(['date', 'time'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
time
</th>
<th>
date
</th>
<th>
variable
</th>
<th>
value
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
14:30:00
</td>
<td>
2022-07-13
</td>
<td>
temperature
</td>
<td>
31.266667
</td>
</tr>
<tr>
<th>
1
</th>
<td>
15:00:00
</td>
<td>
2022-07-13
</td>
<td>
temperature
</td>
<td>
32.048214
</td>
</tr>
<tr>
<th>
2
</th>
<td>
15:30:00
</td>
<td>
2022-07-13
</td>
<td>
temperature
</td>
<td>
32.547368
</td>
</tr>
<tr>
<th>
3
</th>
<td>
16:00:00
</td>
<td>
2022-07-13
</td>
<td>
temperature
</td>
<td>
32.926316
</td>
</tr>
<tr>
<th>
4
</th>
<td>
16:30:00
</td>
<td>
2022-07-13
</td>
<td>
temperature
</td>
<td>
33.198245
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
147
</th>
<td>
16:00:00
</td>
<td>
2022-07-16
</td>
<td>
temperature
</td>
<td>
35.548214
</td>
</tr>
<tr>
<th>
148
</th>
<td>
16:30:00
</td>
<td>
2022-07-16
</td>
<td>
temperature
</td>
<td>
35.810526
</td>
</tr>
<tr>
<th>
149
</th>
<td>
17:00:00
</td>
<td>
2022-07-16
</td>
<td>
temperature
</td>
<td>
35.903573
</td>
</tr>
<tr>
<th>
150
</th>
<td>
17:30:00
</td>
<td>
2022-07-16
</td>
<td>
temperature
</td>
<td>
35.987719
</td>
</tr>
<tr>
<th>
151
</th>
<td>
18:00:00
</td>
<td>
2022-07-16
</td>
<td>
temperature
</td>
<td>
36.000000
</td>
</tr>
</tbody>
</table>
<p>
152 rows × 4 columns
</p>
</div>
{{&lt; /rawhtml &gt;}}
<p>A “melted” dataframe can be plotted fairly easily using a command such as the one below. Besides the x- and y-axes, it is possible to distinguish the lines by hue (in this case, different colors for different dates) and by style (different line style for different variables). Here, it does not make a lot of sense to plot humidity and temperature in the same plot, but it is useful for the sake of the example.</p>
<p>Something else to note in the plot below is that the x-axis starts at 14:30, then continues for 24 hours until 14:00 the next day: this is due to the fact that the data captured by the log is incomplete for the day of 2022-07-13. After searching around for a while, I wasn’t able to reset the ticks on the x-axis to make them work properly, so I had to look for some workarounds.</p>
<p>Indeed, the current plot shows a pretty major inconsistency at 0:00, which is when the date shifts from July 13th to July 14th, which is also why the orange line “jumps” below and seems to be a continuation of the blue line: this is exactly what that is!</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data <span class="op">=</span> df_melted, x<span class="op">=</span><span class="st">'time'</span>, y<span class="op">=</span><span class="st">'value'</span>, hue<span class="op">=</span><span class="st">'date'</span>, style<span class="op">=</span><span class="st">'variable'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ax.tick_params(rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_53_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>It is possible to build a plot by using the full <code>datetime</code> object, rather than splitting by day, and the result is shown below:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_resampled.reset_index().melt(id_vars<span class="op">=</span>[<span class="st">'datetime'</span>], value_vars<span class="op">=</span>[<span class="st">'temperature'</span>])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>display(df_melted)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data <span class="op">=</span> df_melted, x<span class="op">=</span><span class="st">'datetime'</span>, y<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>ax.tick_params(rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th>
datetime
</th>
<th>
variable
</th>
<th>
value
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
2022-07-13 14:30:00
</td>
<td>
temperature
</td>
<td>
31.266667
</td>
</tr>
<tr>
<th>
1
</th>
<td>
2022-07-13 15:00:00
</td>
<td>
temperature
</td>
<td>
32.048214
</td>
</tr>
<tr>
<th>
2
</th>
<td>
2022-07-13 15:30:00
</td>
<td>
temperature
</td>
<td>
32.547368
</td>
</tr>
<tr>
<th>
3
</th>
<td>
2022-07-13 16:00:00
</td>
<td>
temperature
</td>
<td>
32.926316
</td>
</tr>
<tr>
<th>
4
</th>
<td>
2022-07-13 16:30:00
</td>
<td>
temperature
</td>
<td>
33.198245
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
147
</th>
<td>
2022-07-16 16:00:00
</td>
<td>
temperature
</td>
<td>
35.548214
</td>
</tr>
<tr>
<th>
148
</th>
<td>
2022-07-16 16:30:00
</td>
<td>
temperature
</td>
<td>
35.810526
</td>
</tr>
<tr>
<th>
149
</th>
<td>
2022-07-16 17:00:00
</td>
<td>
temperature
</td>
<td>
35.903573
</td>
</tr>
<tr>
<th>
150
</th>
<td>
2022-07-16 17:30:00
</td>
<td>
temperature
</td>
<td>
35.987719
</td>
</tr>
<tr>
<th>
151
</th>
<td>
2022-07-16 18:00:00
</td>
<td>
temperature
</td>
<td>
36.000000
</td>
</tr>
</tbody>
</table>
<p>
152 rows × 3 columns
</p>
</div>
{{&lt; /rawhtml &gt;}}
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_55_1.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<p>Now, this plot looks much clearer, however it’s not exactly what I wanted. For this reason, I decided to get rid of the offending data series (i.e.&nbsp;the incomplete series of readings from the first day) and plot the data for the remaining days. This isn’t really the best way of doing it, which is why I went for the solution in the first section of this post, but it gets the job done at least.</p>
<p>So, now my objective is selecting only the readings that start after the first day has ended, which can be done using either one of the two commands below, whose output is exactly the same.</p>
<p><code>df_resampled.index</code> returns the index of the dataframe, which is in datetime format: this allows to compare it with a different datetime object that I am declaring (either <code>fromisoformat(...)</code> or <code>date(...)</code>). The comparison allows to find the datetime indices that occur after the given value, and keep only those.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df_1 <span class="op">=</span>df_resampled.loc[df_resampled.index <span class="op">&gt;=</span> datetime.datetime.fromisoformat(<span class="st">'2022-07-14 00:00:00'</span>)]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>df_2 <span class="op">=</span>df_resampled.loc[df_resampled.index.date <span class="op">&gt;</span> datetime.date(<span class="dv">2022</span>, <span class="dv">7</span>,<span class="dv">13</span>)]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking that the two indices are equal</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">all</span>(df_1.index <span class="op">==</span> df_2.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>True</code></pre>
<p>Now that there is a cleaner dataframe to plot, the usual <code>lineplot</code> function can be used to prepare the temperature and humidity comparisons. |</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_1.melt(id_vars<span class="op">=</span>[<span class="st">'time'</span>, <span class="st">'date'</span>], value_vars<span class="op">=</span>[<span class="st">'temperature'</span>], value_name<span class="op">=</span><span class="st">'temp'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_melted[<span class="st">'time'</span>] <span class="op">=</span> df_melted[<span class="st">'time'</span>].<span class="bu">apply</span>(datetime.time.isoformat)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_melted.sort_values([<span class="st">'date'</span>, <span class="st">'time'</span>])</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">4</span>))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data <span class="op">=</span> df_melted, x<span class="op">=</span><span class="st">'time'</span>, y<span class="op">=</span><span class="st">'temp'</span>, hue<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>ax.tick_params(rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="study-temperature_files/study-temperature_60_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_1.melt(id_vars<span class="op">=</span>[<span class="st">'time'</span>, <span class="st">'date'</span>], value_vars<span class="op">=</span>[<span class="st">'humidity'</span>], value_name<span class="op">=</span><span class="st">'hum'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_melted[<span class="st">'time'</span>] <span class="op">=</span> df_melted[<span class="st">'time'</span>].<span class="bu">apply</span>(datetime.time.isoformat)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df_melted <span class="op">=</span> df_melted.sort_values([<span class="st">'date'</span>, <span class="st">'time'</span>])</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">4</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data <span class="op">=</span> df_melted, x<span class="op">=</span><span class="st">'time'</span>, y<span class="op">=</span><span class="st">'hum'</span>, hue<span class="op">=</span><span class="st">'date'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>ax.tick_params(rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/study-temperature_files/study-temperature_61_0.png" class="img-fluid figure-img"></p>
<figcaption>png</figcaption>
</figure>
</div>
</section>
<section id="extracting-extremes" class="level3">
<h3 class="anchored" data-anchor-id="extracting-extremes">Extracting extremes</h3>
<p>After splitting the readings on a day-by-day basis using <code>pivot</code>, I looked for a way of getting the extremes using the same table. Turns out, this was far more complex than I thought, especially for printing them in an easy-to-read way.</p>
<p>Let’s start by taking a look at <code>df_pivot</code> again:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>display(df_pivot.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="4" halign="left">
temperature
</th>
<th colspan="4" halign="left">
humidity
</th>
</tr>
<tr>
<th>
date
</th>
<th>
2022-07-13
</th>
<th>
2022-07-14
</th>
<th>
2022-07-15
</th>
<th>
2022-07-16
</th>
<th>
2022-07-13
</th>
<th>
2022-07-14
</th>
<th>
2022-07-15
</th>
<th>
2022-07-16
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
00:00:00
</th>
<td>
NaN
</td>
<td>
29.640351
</td>
<td>
31.483636
</td>
<td>
31.187500
</td>
<td>
NaN
</td>
<td>
44.256141
</td>
<td>
41.012727
</td>
<td>
38.969643
</td>
</tr>
<tr>
<th>
00:30:00
</th>
<td>
NaN
</td>
<td>
29.321428
</td>
<td>
31.041071
</td>
<td>
30.917544
</td>
<td>
NaN
</td>
<td>
44.341071
</td>
<td>
40.332143
</td>
<td>
38.903509
</td>
</tr>
<tr>
<th>
01:00:00
</th>
<td>
NaN
</td>
<td>
29.025000
</td>
<td>
30.600000
</td>
<td>
30.540741
</td>
<td>
NaN
</td>
<td>
44.517857
</td>
<td>
40.024561
</td>
<td>
39.196297
</td>
</tr>
<tr>
<th>
01:30:00
</th>
<td>
NaN
</td>
<td>
28.775000
</td>
<td>
30.238182
</td>
<td>
30.076786
</td>
<td>
NaN
</td>
<td>
44.776786
</td>
<td>
39.936363
</td>
<td>
39.655357
</td>
</tr>
<tr>
<th>
02:00:00
</th>
<td>
NaN
</td>
<td>
28.519298
</td>
<td>
29.961403
</td>
<td>
29.866071
</td>
<td>
NaN
</td>
<td>
44.966667
</td>
<td>
40.045614
</td>
<td>
39.594642
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<p>This dataframe has a two-level header, with one half of the column covering the temperature on different days, and the other half recording humidity in the same periods of time. The index is a timeseries (not a datetime anymore, since the date is recorded in the columns).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the extremes and saving them in dataframes</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>val_idxmax<span class="op">=</span>df_pivot[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].<span class="bu">apply</span>(pd.Series.idxmax)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>val_max<span class="op">=</span>df_pivot[[<span class="st">'temperature'</span>, <span class="st">'humidity'</span>]].<span class="bu">apply</span>(pd.Series.<span class="bu">max</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenating dataframes</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df_concat <span class="op">=</span> pd.concat([val_idxmax, val_max],  axis<span class="op">=</span><span class="dv">1</span>).reset_index().pivot(index<span class="op">=</span><span class="st">'date'</span>, columns<span class="op">=</span><span class="st">'level_0'</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>df_concat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="2" halign="left">
0
</th>
<th colspan="2" halign="left">
1
</th>
</tr>
<tr>
<th>
level_0
</th>
<th>
humidity
</th>
<th>
temperature
</th>
<th>
humidity
</th>
<th>
temperature
</th>
</tr>
<tr>
<th>
date
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-07-13
</th>
<td>
14:30:00
</td>
<td>
18:00:00
</td>
<td>
49.774510
</td>
<td>
33.494737
</td>
</tr>
<tr>
<th>
2022-07-14
</th>
<td>
10:30:00
</td>
<td>
18:00:00
</td>
<td>
47.358182
</td>
<td>
35.562499
</td>
</tr>
<tr>
<th>
2022-07-15
</th>
<td>
10:00:00
</td>
<td>
16:00:00
</td>
<td>
43.696364
</td>
<td>
36.289285
</td>
</tr>
<tr>
<th>
2022-07-16
</th>
<td>
09:00:00
</td>
<td>
18:00:00
</td>
<td>
51.060715
</td>
<td>
36.000000
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<p>The result above kind of works, but is not very understandable: on the left, we have the <em>time at which the extreme was measured</em> and on the right we have the actual measured value.</p>
<p>It would be nicer to have a format similar to the original <code>df_pivot</code>, with temperature and humidity on top and the two variables <code>timeat</code> and <code>measured value</code> below. This can be done using a <code>MultiIndex</code>, which in this case I am building with the function <code>.from_product</code>. This function executes the cartesian product of the iterables passed as inputs and produces a MultiIndex object where each iterable represents a level in the multiindex.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mi <span class="op">=</span> pd.MultiIndex.from_product([[<span class="st">'humidity'</span>, <span class="st">'temperature'</span>], [<span class="st">'timeat'</span>, <span class="st">'value'</span>]])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>mi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>MultiIndex([(   'humidity', 'timeat'),
            (   'humidity',  'value'),
            ('temperature', 'timeat'),
            ('temperature',  'value')],
           )</code></pre>
<p>At this point, I was looking for a way of massaging the columns and the index in order to make them match the multiindex, and this is what I came up with. Pretty ugly, but it works.</p>
<p>For each row in <code>df_concat</code>, I select the two columns of the multiindex (<code>timeat</code> and <code>value</code>, with labels 0 and 1 respectively), and then the specific variable (either humidity or temperature), so that the content of the list is:</p>
<pre><code>[row[timeat][humidity], row[value, humidity], row[timeat][temperature], row[value][temperature]]</code></pre>
<p>Finally, I add the index (i.e.&nbsp;the date) to the list, then I build the dataframe starting from those records. In the new dataframe, the index is then set to use the <code>date</code> column added to the list.</p>
<p>This is one way of printing the values, however I later realized that this makes actual pretty printing far more difficult, and the entire process thus far was quite clunky and “unpythonic”, which is why I decided to something else.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rows<span class="op">=</span>[]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> df_concat.iterrows():</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> [row[i_][variable]  <span class="cf">for</span> variable <span class="kw">in</span> [<span class="st">'humidity'</span>, <span class="st">'temperature'</span>] <span class="cf">for</span> i_ <span class="kw">in</span> [<span class="dv">0</span>,<span class="dv">1</span>] ]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    rows.append([idx] <span class="op">+</span> t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> pd.DataFrame.from_records(rows)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_new<span class="op">=</span>df_new.set_index(<span class="dv">0</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df_new.index.rename(<span class="st">'date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>df_new.columns <span class="op">=</span> mi</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>df_new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
{{&lt; rawhtml &gt;}}
<div>

<table class="dataframe table table-sm table-striped small">
<thead>
<tr>
<th>
</th>
<th colspan="2" halign="left">
humidity
</th>
<th colspan="2" halign="left">
temperature
</th>
</tr>
<tr>
<th>
</th>
<th>
timeat
</th>
<th>
value
</th>
<th>
timeat
</th>
<th>
value
</th>
</tr>
<tr>
<th>
date
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-07-13
</th>
<td>
14:30:00
</td>
<td>
49.774510
</td>
<td>
18:00:00
</td>
<td>
33.494737
</td>
</tr>
<tr>
<th>
2022-07-14
</th>
<td>
10:30:00
</td>
<td>
47.358182
</td>
<td>
18:00:00
</td>
<td>
35.562499
</td>
</tr>
<tr>
<th>
2022-07-15
</th>
<td>
10:00:00
</td>
<td>
43.696364
</td>
<td>
16:00:00
</td>
<td>
36.289285
</td>
</tr>
<tr>
<th>
2022-07-16
</th>
<td>
09:00:00
</td>
<td>
51.060715
</td>
<td>
18:00:00
</td>
<td>
36.000000
</td>
</tr>
</tbody>
</table>
</div>
{{&lt; /rawhtml &gt;}}
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.riccardocappuzzo\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Riccardo Cappuzzo</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>